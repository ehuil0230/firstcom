{"remainingRequest":"D:\\vueWorkspace\\cyfz\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vueWorkspace\\cyfz\\src\\views\\xdqgl\\myToolbar\\xdqxxtbCreOperation.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vueWorkspace\\cyfz\\src\\views\\xdqgl\\myToolbar\\xdqxxtbCreOperation.vue","mtime":1571370842205},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport cyImageUpload from \"../../../components/upAndDown/cyImageUpload\";\n\nexport default {\n    name: \"xdqxxtbCreOperation\",\n    components: {\n        cyImageUpload\n    },\n    props : {\n    },\n    data() {\n        return {\n            dialogVisible: false,\n            //表单\n            rules: {\n                pilotAreaName: [\n                    { required: true, message: '请填写先导区名称'},\n                    { max: 50, message: '长度在50个字符串'}\n                ],\n                pilotLevelDm: [\n                    { required: true, message: '请选择先导区级别'}\n                ],\n                provinceDm: [\n                    { required: true, message: '请选择所属省份'}\n                ],\n                approvalOrg: [\n                    { required: true, message: '请填写批准机关'},\n                    { max: 50, message: '长度在50个字符串'}\n                ],\n                primeIndustry: [\n                    { required: true, message: '请填写主导产业'},\n                    { max: 200, message: '长度在200个字符串'}\n                ],\n                area: [\n                    { required: true, message: '请填写占地面积' },\n                    { type: 'number', message: '占地面积必须是数字' }\n                    // { max: 50, message: '长度在50个字符串', trigger: 'blur' }\n                ],\n                aiEnterpriseNum: [\n                    { required: true, message: '请填写人工智能企业数' },\n                    { type: 'number', message: '人工智能企业数必须是数字' },\n                    // { min:1, max: 50, message: '长度在50个字符串以内', trigger: 'blur' }\n                ],\n                introduction: [\n                    { required: true, message: '请填写先导区简介' },\n                    { max: 200, message: '长度在200个字符以内' }\n                ],\n                preferentialPolicy: [\n                    { required: true, message: '请填写优惠政策' },\n                    { max: 200, message: '长度在200个字符以内' }\n                ],\n                achievement : [\n                    { required: true, message: '请填写先导区取得成效' },\n                    { max: 200, message: '长度在200个字符以内' }\n                ],\n                pictureUrl : [\n                    { required: true, message: '请上传先导区展示图' }\n                ]\n            },\n            pilotLevels: [],\n            provinces: [],\n            xdqxxtbForm: {\n                uuid: '',\n                pilotAreaName: '',\n                imageUrl: '',\n                pilotLevelDm: '',\n                provinceDm:'',\n                approvalOrg: '',\n                primeIndustry: '',\n                area: '',\n                aiEnterpriseNum: '',\n                introduction: '',\n                preferentialPolicy: '',\n                achievement: '',\n                state: 0,\n                tableid: ''\n            },\n            fileData: {\n                fileNum: 1,\n                relatedId: '',\n                allowUpload: true,\n                autoUp: true,\n                fromType: '0001',\n                spType: '010001'\n            }\n        }\n    },\n    created() {\n        window.console.log('xdqxxtbCreOperation created-------------')\n    },\n    methods: {\n        //弹窗初始化\n        init(uuid)\n        {\n            let that = this\n            window.console.log('弹窗初始化')\n            // 加载下拉框字典数据\n            that.initCodeData()\n\n            that.dialogVisible = true\n\n            // 若是修改，数据初始化\n            if ($.isNotEmpty(uuid)){\n                // 修改\n                this.$$request({\n                    method: 'post',\n                    url: this.$api.xdqglApi.pilotAreaDetail,\n                    data: {\n                        uuid : uuid\n                    }\n                }).then(function (res) {\n                    if (res.result === 1) {\n                        that.xdqxxtbForm = res.info\n\n                        that.xdqxxtbForm.area = $.isNotEmpty(that.xdqxxtbForm.area)?\n                            Number(that.xdqxxtbForm.area):0\n\n                        // 修改时，文件上传数据\n                        that.fileData.relatedId = that.xdqxxtbForm.uuid\n                    }else {\n                        that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\n                        return false\n                    }\n                }).catch(function (error) {\n                    that.$alert(error, \"系统异常，请联系管理员！\", {})\n                    return false\n                })\n            }else{\n                if (that.$refs.xdqxxtbForm) {\n                    that.$refs.xdqxxtbForm.resetFields()\n                }\n                if (that.$refs.upload) {\n                    that.$refs.upload.image = {\n                        relatedid: '',\n                        MD5Path: '',\n                        fileName: '',\n                        url: ''\n                    }\n                }\n\n                that.xdqxxtbForm.uuid = ''\n                that.xdqxxtbForm.state = ''\n\n                // 新建时，初始化文件上传\n                that.fileData.relatedId = ''\n\n            }\n        },\n        initCodeData() {\n            const that = this\n            this.$$request({\n                method: 'post',\n                url: that.$api.getCodeData,\n                data: {\n                    tableName : \"DM_PROVINCE\"\n                }\n            }).then(function (res) {\n                if (res.result === 1) {\n                    that.provinces = res.info\n                }else {\n                    that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\n                    return false\n                }\n            }).catch(function (error) {\n                that.$alert(error, \"系统异常，请联系管理员！\", {})\n                return false\n            })\n            this.$$request({\n                method: 'post',\n                url: that.$api.getCodeData,\n                data: {\n                    tableName : \"DM_PILOT_LEVEL\"\n                }\n            }).then(function (res) {\n                if (res.result === 1) {\n                    that.pilotLevels = res.info\n                }else {\n                    that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\n                    return false\n                }\n            }).catch(function (error) {\n                that.$alert(error, \"系统异常，请联系管理员！\", {})\n                return false\n            })\n        },\n        // 统一保存方法，保存和提交都会调用\n        uniformSave(formName){\n            // 首先判断状态，审批完成后无法修改\n            if (this.xdqxxtbForm.state > 0 && this.xdqxxtbForm.state < 9) {\n                this.$alert('审核状态中无法修改！', '提示', {\n                    type: 'warning'\n                })\n                return false\n            } else if(this.xdqxxtbForm.state == 9){\n                this.$alert('已发布内容无法修改！', '提示', {\n                    type: 'warning'\n                })\n                return false\n            }\n\n            let that = this\n            let url = ''\n            // 后台代码问题暂时处理，今后要删除，不应该在前端传递状态\n            this.xdqxxtbForm.state = 0\n            let data = {\n                ...this.xdqxxtbForm\n            }\n            if ($.isNotEmpty(this.xdqxxtbForm.uuid)) {\n                // 修改\n                url = this.$api.xdqglApi.pilotAreaUpdate\n                data.uuid = this.xdqxxtbForm.uuid\n            } else {\n                // 新增\n                url = this.$api.xdqglApi.pilotAreaSave\n            }\n            let saveRequestPromise = null\n            this.$refs[formName].validate((valid) => {\n                // 表单验证通过\n                if (valid) {\n                    const promise = that.$$request({\n                        method: 'post',\n                        url: url,\n                        data: data\n                    }).then(function (res) {\n                        if (res.result === 1) {\n                            that.xdqxxtbForm.uuid = res.info.uuid\n                            return res\n                        }else {\n                            that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\n                            return false\n                        }\n                    }).then(function (res) {\n                        // 保存成功后，检查是否需要上传附件\n                        let res1 = res\n                        // 只有新增才需要单独处理上传，修改不需要\n                        if (res1 && url == that.$api.xdqglApi.pilotAreaSave) {\n                            let param = {\n                                \"relatedid\": res.info.uuid,\n                                \"MD5Path\": that.$refs.upload.image.MD5Path,\n                                \"fileName\": that.$refs.upload.image.fileName\n                            }\n                            that.$$insertFileInfo(param).\n                            then((resdata) => {\n                                res1 = resdata\n                            }).catch(function (err) {\n                                that.$message({\n                                    message: '关联附件列表失败',\n                                    type: 'warning'\n                                })\n                            })\n                        }\n                        return res1\n                    })\n                    saveRequestPromise = promise\n                }else {\n                    window.console.log('验证未通过!')\n                    return false\n                }\n            })\n            return saveRequestPromise\n        },\n        // 保存\n        saveForm(formName)\n        {\n            let that = this\n            let successTip = ''\n            if ($.isNotEmpty(this.xdqxxtbForm.uuid)) {\n                // 修改\n                successTip = '修改成功'\n            } else {\n                // 新增\n                successTip = '保存成功'\n            }\n            const savePromise = this.uniformSave(formName)\n            if (savePromise instanceof Promise) {\n                savePromise.then((res) => {\n                    if (res.result === 1) {\n                        that.$alert(successTip, '提示', {\n                            type: 'success'\n                        })\n                        that.dialogVisible = false\n                        // 控制外层父组件对话框\n                        that.$emit('displayDialog', false)\n\n                        that.$refs[formName].resetFields()\n                        // that.$refs.table.loadData()\n                        that.$emit('loadData')\n                    }\n                }).catch((error) => {\n                    that.$alert(error, \"保存时出现异常，请联系管理员！\", {})\n                    return false\n                })\n            }\n        },\n        // 提交\n        submitForm(formName) {\n            let that = this\n            let url = that.$api.xdqglApi.uniformSubmit\n            let successTip = '提交成功'\n            let approvalDm = '010020' // 审核代码\n            const savePromise = this.uniformSave(formName)\n            if (savePromise instanceof Promise) {\n                savePromise.then((res) => {\n                    if (res.result === 1) {\n                        that.xdqxxtbForm.tableid = that.xdqxxtbForm.uuid\n                        that.xdqxxtbForm.uuid = ''\n                        // 后台代码问题暂时处理，今后要删除，不应该在前端传递状态\n                        // 1-8之间任意数字，先随便设置为5\n                        that.xdqxxtbForm.state = 5\n                        let data = {\n                            ...that.xdqxxtbForm,\n                            approvalDm: approvalDm,\n                            title:that.xdqxxtbForm.pilotAreaName\n                        }\n                        this.$$request({\n                            method: 'post',\n                            url: url,\n                            data: data\n                        }).then(function (res) {\n                            if (res.result === 1) {\n                                that.$alert(successTip, '提示', {\n                                    type: 'success'\n                                })\n                                that.dialogVisible = false\n                                // 控制外层父组件对话框\n                                that.$emit('displayDialog', false)\n\n                                that.$refs[formName].resetFields()\n                                // that.$refs.table.loadData()\n                                that.$emit('loadData')\n                            }else {\n                                that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\n                                return false\n                            }\n                        })\n                    }\n                }).catch((error) => {\n                    that.$alert(error, \"提交时出现异常，请联系管理员！\", {})\n                    return false\n                })\n            }\n        },\n        //关闭\n        closeForm(formName)\n        {\n            this.dialogVisible = false\n            this.visible = false\n            /*this.ruleForm = '', */\n            this.$refs[formName].close();\n            return false;\n        },\n        handleOpen() {\n\n        },\n        handleClose(done){\n            done()\n            window.console.log('对话框关闭前')\n        },\n\n    }\n}\n",{"version":3,"sources":["xdqxxtbCreOperation.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmJA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"xdqxxtbCreOperation.vue","sourceRoot":"src/views/xdqgl/myToolbar","sourcesContent":["<template>\r\n    <div class=\"xdq-dialog\">\r\n        <el-dialog\r\n            title=\"先导区信息填报详情\"\r\n            :close-on-click-modal=\"false\"\r\n            :visible.sync=\"dialogVisible\"\r\n            width=\"80%\"\r\n            height=\"800px\"\r\n            :open=\"handleOpen\"\r\n            :before-close=\"handleClose\">\r\n            <div class=\"form-t\">\r\n                <el-form :model=\"xdqxxtbForm\" :rules=\"rules\" ref=\"xdqxxtbForm\" label-width=\"0px\" class=\"formTable\">\r\n                    <el-input type=\"hidden\" class=\"hidden-input\" v-model=\"xdqxxtbForm.uuid\"></el-input>\r\n                    <el-row type=\"flex\" justify=\"space-around\" align=\"top\">\r\n                        <el-col :span=\"18\">\r\n                            <el-row type=\"flex\" justify=\"space-around\" align=\"middle\">\r\n                                <el-col class=\"label-col\" :span=\"4\">\r\n                                    <label>先导区名称</label>\r\n                                </el-col>\r\n                                <el-col :span=\"8\">\r\n                                    <el-form-item prop=\"pilotAreaName\">\r\n                                        <el-input v-model=\"xdqxxtbForm.pilotAreaName\"></el-input>\r\n                                    </el-form-item>\r\n                                </el-col>\r\n                                <el-col class=\"label-col\" :span=\"4\">\r\n                                    <label>先导区级别</label>\r\n                                </el-col>\r\n                                <el-col :span=\"8\">\r\n                                    <el-form-item prop=\"pilotLevelDm\">\r\n                                        <el-select v-model=\"xdqxxtbForm.pilotLevelDm\" placeholder=\"请选择先导区级别\">\r\n                                            <el-option\r\n                                                    v-for=\"item in pilotLevels\"\r\n                                                    :key=\"item.CODE\"\r\n                                                    :label=\"item.CAPTION\"\r\n                                                    :value=\"item.CODE\">\r\n                                            </el-option>\r\n                                        </el-select>\r\n                                    </el-form-item>\r\n                                </el-col>\r\n                            </el-row>\r\n                            <el-row type=\"flex\" justify=\"space-around\" align=\"middle\">\r\n                                <el-col class=\"label-col\" :span=\"4\">\r\n                                    <label>所在省份</label>\r\n                                </el-col>\r\n                                <el-col :span=\"8\">\r\n                                    <el-form-item prop=\"provinceDm\">\r\n                                        <el-select v-model=\"xdqxxtbForm.provinceDm\" placeholder=\"请选择所在省份\">\r\n                                            <el-option\r\n                                                    v-for=\"item in provinces\"\r\n                                                    :key=\"item.CODE\"\r\n                                                    :label=\"item.CAPTION\"\r\n                                                    :value=\"item.CODE\">\r\n                                            </el-option>\r\n                                        </el-select>\r\n                                    </el-form-item>\r\n                                </el-col>\r\n                                <el-col class=\"label-col\" :span=\"4\">\r\n                                    <label>批准机关</label>\r\n                                </el-col>\r\n                                <el-col :span=\"8\">\r\n                                    <el-form-item prop=\"approvalOrg\">\r\n                                        <el-input v-model=\"xdqxxtbForm.approvalOrg\"></el-input>\r\n                                    </el-form-item>\r\n                                </el-col>\r\n                            </el-row>\r\n                            <el-row type=\"flex\" justify=\"space-around\" align=\"middle\">\r\n                                <el-col class=\"label-col\" :span=\"4\">\r\n                                    <label class=\"long-label\">主导产业</label>\r\n                                </el-col>\r\n                                <el-col :span=\"8\">\r\n                                    <el-form-item prop=\"primeIndustry\">\r\n                                        <el-input v-model=\"xdqxxtbForm.primeIndustry\"></el-input>\r\n                                    </el-form-item>\r\n                                </el-col>\r\n                                <el-col class=\"label-col\" :span=\"4\">\r\n                                    <label class=\"long-label\">占地面积 (km²)</label>\r\n                                </el-col>\r\n                                <el-col :span=\"8\">\r\n                                    <el-form-item prop=\"area\">\r\n                                        <el-input v-model.number=\"xdqxxtbForm.area\" placeholder=\"单位：平方公里\"></el-input>\r\n                                    </el-form-item>\r\n                                </el-col>\r\n                            </el-row>\r\n                        </el-col>\r\n                        <el-col :span=\"6\">\r\n<!--                            <p key=\"myTip\" v-if=\"fileData.showTip\" class=\"file-tip\" style=\"font-size: 10px\">-->\r\n<!--                                <i class=\"el-icon-warning\">请先保存后再上传附件</i>-->\r\n<!--                            </p>-->\r\n                            <cy-image-upload ref=\"upload\" v-if=\"fileData.allowUpload\" :autoUp=\"fileData.autoUp\"\r\n                                            :file-num=\"fileData.fileNum\" :relatedId=\"fileData.relatedId\">\r\n                            </cy-image-upload>\r\n                        </el-col>\r\n                    </el-row>\r\n                    <el-row type=\"flex\" justify=\"space-around\" align=\"middle\">\r\n                        <el-col class=\"label-col\" :span=\"3\">\r\n                            <label class=\"short-label\">人工智能企业数</label>\r\n                        </el-col>\r\n                        <el-col :span=\"21\">\r\n                            <el-form-item prop=\"aiEnterpriseNum\">\r\n                                <el-input v-model.number=\"xdqxxtbForm.aiEnterpriseNum\"></el-input>\r\n                            </el-form-item>\r\n                        </el-col>\r\n                    </el-row>\r\n                    <el-row type=\"flex\" justify=\"space-around\" align=\"middle\">\r\n                        <el-col class=\"label-col textarea-row\" :span=\"3\">\r\n                            <label class=\"short-label\">先导区简介</label>\r\n                        </el-col>\r\n                        <el-col class=\"textarea-row\" :span=\"21\">\r\n                            <el-form-item prop=\"introduction\">\r\n                                <el-input type=\"textarea\" placeholder=\"200字以内\" v-model=\"xdqxxtbForm.introduction\"></el-input>\r\n                            </el-form-item>\r\n                        </el-col>\r\n                    </el-row>\r\n                    <el-row type=\"flex\" justify=\"space-around\" align=\"middle\">\r\n                        <el-col class=\"label-col textarea-row\" :span=\"3\">\r\n                            <label class=\"short-label\">优惠政策</label>\r\n                        </el-col>\r\n                        <el-col class=\"textarea-row\" :span=\"21\">\r\n                            <el-form-item prop=\"preferentialPolicy\">\r\n                                <el-input type=\"textarea\" placeholder=\"200字以内\" v-model=\"xdqxxtbForm.preferentialPolicy\"></el-input>\r\n                            </el-form-item>\r\n                        </el-col>\r\n                    </el-row>\r\n                    <el-row type=\"flex\" justify=\"space-around\" align=\"middle\">\r\n                        <el-col class=\"label-col textarea-row\" :span=\"3\">\r\n                            <label class=\"short-label\">先导区取得成效</label>\r\n                        </el-col>\r\n                        <el-col class=\"textarea-row\" :span=\"21\">\r\n                            <el-form-item prop=\"achievement\">\r\n                                <el-input type=\"textarea\" placeholder=\"200字以内\" v-model=\"xdqxxtbForm.achievement\"></el-input>\r\n                            </el-form-item>\r\n                        </el-col>\r\n                    </el-row>\r\n                    <el-row>\r\n                        <el-col class=\"btns\" :span=\"24\">\r\n                            <el-button type=\"primary\" @click=\"saveForm('xdqxxtbForm')\">保存</el-button>\r\n                            <el-button @click=\"submitForm('xdqxxtbForm')\">提交</el-button>\r\n                        </el-col>\r\n                    </el-row>\r\n                </el-form>\r\n            </div>\r\n        </el-dialog>\r\n    </div>\r\n\r\n</template>\r\n\r\n<script>\r\n    import cyImageUpload from \"../../../components/upAndDown/cyImageUpload\";\r\n\r\n    export default {\r\n        name: \"xdqxxtbCreOperation\",\r\n        components: {\r\n            cyImageUpload\r\n        },\r\n        props : {\r\n        },\r\n        data() {\r\n            return {\r\n                dialogVisible: false,\r\n                //表单\r\n                rules: {\r\n                    pilotAreaName: [\r\n                        { required: true, message: '请填写先导区名称'},\r\n                        { max: 50, message: '长度在50个字符串'}\r\n                    ],\r\n                    pilotLevelDm: [\r\n                        { required: true, message: '请选择先导区级别'}\r\n                    ],\r\n                    provinceDm: [\r\n                        { required: true, message: '请选择所属省份'}\r\n                    ],\r\n                    approvalOrg: [\r\n                        { required: true, message: '请填写批准机关'},\r\n                        { max: 50, message: '长度在50个字符串'}\r\n                    ],\r\n                    primeIndustry: [\r\n                        { required: true, message: '请填写主导产业'},\r\n                        { max: 200, message: '长度在200个字符串'}\r\n                    ],\r\n                    area: [\r\n                        { required: true, message: '请填写占地面积' },\r\n                        { type: 'number', message: '占地面积必须是数字' }\r\n                        // { max: 50, message: '长度在50个字符串', trigger: 'blur' }\r\n                    ],\r\n                    aiEnterpriseNum: [\r\n                        { required: true, message: '请填写人工智能企业数' },\r\n                        { type: 'number', message: '人工智能企业数必须是数字' },\r\n                        // { min:1, max: 50, message: '长度在50个字符串以内', trigger: 'blur' }\r\n                    ],\r\n                    introduction: [\r\n                        { required: true, message: '请填写先导区简介' },\r\n                        { max: 200, message: '长度在200个字符以内' }\r\n                    ],\r\n                    preferentialPolicy: [\r\n                        { required: true, message: '请填写优惠政策' },\r\n                        { max: 200, message: '长度在200个字符以内' }\r\n                    ],\r\n                    achievement : [\r\n                        { required: true, message: '请填写先导区取得成效' },\r\n                        { max: 200, message: '长度在200个字符以内' }\r\n                    ],\r\n                    pictureUrl : [\r\n                        { required: true, message: '请上传先导区展示图' }\r\n                    ]\r\n                },\r\n                pilotLevels: [],\r\n                provinces: [],\r\n                xdqxxtbForm: {\r\n                    uuid: '',\r\n                    pilotAreaName: '',\r\n                    imageUrl: '',\r\n                    pilotLevelDm: '',\r\n                    provinceDm:'',\r\n                    approvalOrg: '',\r\n                    primeIndustry: '',\r\n                    area: '',\r\n                    aiEnterpriseNum: '',\r\n                    introduction: '',\r\n                    preferentialPolicy: '',\r\n                    achievement: '',\r\n                    state: 0,\r\n                    tableid: ''\r\n                },\r\n                fileData: {\r\n                    fileNum: 1,\r\n                    relatedId: '',\r\n                    allowUpload: true,\r\n                    autoUp: true,\r\n                    fromType: '0001',\r\n                    spType: '010001'\r\n                }\r\n            }\r\n        },\r\n        created() {\r\n            window.console.log('xdqxxtbCreOperation created-------------')\r\n        },\r\n        methods: {\r\n            //弹窗初始化\r\n            init(uuid)\r\n            {\r\n                let that = this\r\n                window.console.log('弹窗初始化')\r\n                // 加载下拉框字典数据\r\n                that.initCodeData()\r\n\r\n                that.dialogVisible = true\r\n\r\n                // 若是修改，数据初始化\r\n                if ($.isNotEmpty(uuid)){\r\n                    // 修改\r\n                    this.$$request({\r\n                        method: 'post',\r\n                        url: this.$api.xdqglApi.pilotAreaDetail,\r\n                        data: {\r\n                            uuid : uuid\r\n                        }\r\n                    }).then(function (res) {\r\n                        if (res.result === 1) {\r\n                            that.xdqxxtbForm = res.info\r\n\r\n                            that.xdqxxtbForm.area = $.isNotEmpty(that.xdqxxtbForm.area)?\r\n                                Number(that.xdqxxtbForm.area):0\r\n\r\n                            // 修改时，文件上传数据\r\n                            that.fileData.relatedId = that.xdqxxtbForm.uuid\r\n                        }else {\r\n                            that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\r\n                            return false\r\n                        }\r\n                    }).catch(function (error) {\r\n                        that.$alert(error, \"系统异常，请联系管理员！\", {})\r\n                        return false\r\n                    })\r\n                }else{\r\n                    if (that.$refs.xdqxxtbForm) {\r\n                        that.$refs.xdqxxtbForm.resetFields()\r\n                    }\r\n                    if (that.$refs.upload) {\r\n                        that.$refs.upload.image = {\r\n                            relatedid: '',\r\n                            MD5Path: '',\r\n                            fileName: '',\r\n                            url: ''\r\n                        }\r\n                    }\r\n\r\n                    that.xdqxxtbForm.uuid = ''\r\n                    that.xdqxxtbForm.state = ''\r\n\r\n                    // 新建时，初始化文件上传\r\n                    that.fileData.relatedId = ''\r\n\r\n                }\r\n            },\r\n            initCodeData() {\r\n                const that = this\r\n                this.$$request({\r\n                    method: 'post',\r\n                    url: that.$api.getCodeData,\r\n                    data: {\r\n                        tableName : \"DM_PROVINCE\"\r\n                    }\r\n                }).then(function (res) {\r\n                    if (res.result === 1) {\r\n                        that.provinces = res.info\r\n                    }else {\r\n                        that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\r\n                        return false\r\n                    }\r\n                }).catch(function (error) {\r\n                    that.$alert(error, \"系统异常，请联系管理员！\", {})\r\n                    return false\r\n                })\r\n                this.$$request({\r\n                    method: 'post',\r\n                    url: that.$api.getCodeData,\r\n                    data: {\r\n                        tableName : \"DM_PILOT_LEVEL\"\r\n                    }\r\n                }).then(function (res) {\r\n                    if (res.result === 1) {\r\n                        that.pilotLevels = res.info\r\n                    }else {\r\n                        that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\r\n                        return false\r\n                    }\r\n                }).catch(function (error) {\r\n                    that.$alert(error, \"系统异常，请联系管理员！\", {})\r\n                    return false\r\n                })\r\n            },\r\n            // 统一保存方法，保存和提交都会调用\r\n            uniformSave(formName){\r\n                // 首先判断状态，审批完成后无法修改\r\n                if (this.xdqxxtbForm.state > 0 && this.xdqxxtbForm.state < 9) {\r\n                    this.$alert('审核状态中无法修改！', '提示', {\r\n                        type: 'warning'\r\n                    })\r\n                    return false\r\n                } else if(this.xdqxxtbForm.state == 9){\r\n                    this.$alert('已发布内容无法修改！', '提示', {\r\n                        type: 'warning'\r\n                    })\r\n                    return false\r\n                }\r\n\r\n                let that = this\r\n                let url = ''\r\n                // 后台代码问题暂时处理，今后要删除，不应该在前端传递状态\r\n                this.xdqxxtbForm.state = 0\r\n                let data = {\r\n                    ...this.xdqxxtbForm\r\n                }\r\n                if ($.isNotEmpty(this.xdqxxtbForm.uuid)) {\r\n                    // 修改\r\n                    url = this.$api.xdqglApi.pilotAreaUpdate\r\n                    data.uuid = this.xdqxxtbForm.uuid\r\n                } else {\r\n                    // 新增\r\n                    url = this.$api.xdqglApi.pilotAreaSave\r\n                }\r\n                let saveRequestPromise = null\r\n                this.$refs[formName].validate((valid) => {\r\n                    // 表单验证通过\r\n                    if (valid) {\r\n                        const promise = that.$$request({\r\n                            method: 'post',\r\n                            url: url,\r\n                            data: data\r\n                        }).then(function (res) {\r\n                            if (res.result === 1) {\r\n                                that.xdqxxtbForm.uuid = res.info.uuid\r\n                                return res\r\n                            }else {\r\n                                that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\r\n                                return false\r\n                            }\r\n                        }).then(function (res) {\r\n                            // 保存成功后，检查是否需要上传附件\r\n                            let res1 = res\r\n                            // 只有新增才需要单独处理上传，修改不需要\r\n                            if (res1 && url == that.$api.xdqglApi.pilotAreaSave) {\r\n                                let param = {\r\n                                    \"relatedid\": res.info.uuid,\r\n                                    \"MD5Path\": that.$refs.upload.image.MD5Path,\r\n                                    \"fileName\": that.$refs.upload.image.fileName\r\n                                }\r\n                                that.$$insertFileInfo(param).\r\n                                then((resdata) => {\r\n                                    res1 = resdata\r\n                                }).catch(function (err) {\r\n                                    that.$message({\r\n                                        message: '关联附件列表失败',\r\n                                        type: 'warning'\r\n                                    })\r\n                                })\r\n                            }\r\n                            return res1\r\n                        })\r\n                        saveRequestPromise = promise\r\n                    }else {\r\n                        window.console.log('验证未通过!')\r\n                        return false\r\n                    }\r\n                })\r\n                return saveRequestPromise\r\n            },\r\n            // 保存\r\n            saveForm(formName)\r\n            {\r\n                let that = this\r\n                let successTip = ''\r\n                if ($.isNotEmpty(this.xdqxxtbForm.uuid)) {\r\n                    // 修改\r\n                    successTip = '修改成功'\r\n                } else {\r\n                    // 新增\r\n                    successTip = '保存成功'\r\n                }\r\n                const savePromise = this.uniformSave(formName)\r\n                if (savePromise instanceof Promise) {\r\n                    savePromise.then((res) => {\r\n                        if (res.result === 1) {\r\n                            that.$alert(successTip, '提示', {\r\n                                type: 'success'\r\n                            })\r\n                            that.dialogVisible = false\r\n                            // 控制外层父组件对话框\r\n                            that.$emit('displayDialog', false)\r\n\r\n                            that.$refs[formName].resetFields()\r\n                            // that.$refs.table.loadData()\r\n                            that.$emit('loadData')\r\n                        }\r\n                    }).catch((error) => {\r\n                        that.$alert(error, \"保存时出现异常，请联系管理员！\", {})\r\n                        return false\r\n                    })\r\n                }\r\n            },\r\n            // 提交\r\n            submitForm(formName) {\r\n                let that = this\r\n                let url = that.$api.xdqglApi.uniformSubmit\r\n                let successTip = '提交成功'\r\n                let approvalDm = '010020' // 审核代码\r\n                const savePromise = this.uniformSave(formName)\r\n                if (savePromise instanceof Promise) {\r\n                    savePromise.then((res) => {\r\n                        if (res.result === 1) {\r\n                            that.xdqxxtbForm.tableid = that.xdqxxtbForm.uuid\r\n                            that.xdqxxtbForm.uuid = ''\r\n                            // 后台代码问题暂时处理，今后要删除，不应该在前端传递状态\r\n                            // 1-8之间任意数字，先随便设置为5\r\n                            that.xdqxxtbForm.state = 5\r\n                            let data = {\r\n                                ...that.xdqxxtbForm,\r\n                                approvalDm: approvalDm,\r\n                                title:that.xdqxxtbForm.pilotAreaName\r\n                            }\r\n                            this.$$request({\r\n                                method: 'post',\r\n                                url: url,\r\n                                data: data\r\n                            }).then(function (res) {\r\n                                if (res.result === 1) {\r\n                                    that.$alert(successTip, '提示', {\r\n                                        type: 'success'\r\n                                    })\r\n                                    that.dialogVisible = false\r\n                                    // 控制外层父组件对话框\r\n                                    that.$emit('displayDialog', false)\r\n\r\n                                    that.$refs[formName].resetFields()\r\n                                    // that.$refs.table.loadData()\r\n                                    that.$emit('loadData')\r\n                                }else {\r\n                                    that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\r\n                                    return false\r\n                                }\r\n                            })\r\n                        }\r\n                    }).catch((error) => {\r\n                        that.$alert(error, \"提交时出现异常，请联系管理员！\", {})\r\n                        return false\r\n                    })\r\n                }\r\n            },\r\n            //关闭\r\n            closeForm(formName)\r\n            {\r\n                this.dialogVisible = false\r\n                this.visible = false\r\n                /*this.ruleForm = '', */\r\n                this.$refs[formName].close();\r\n                return false;\r\n            },\r\n            handleOpen() {\r\n\r\n            },\r\n            handleClose(done){\r\n                done()\r\n                window.console.log('对话框关闭前')\r\n            },\r\n\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n    /*.form-t /deep/ .el-row {*/\r\n    /*    height: 66px;*/\r\n    /*    line-height: 50px;*/\r\n    /*}*/\r\n    .form-t /deep/ .el-col{\r\n        position: relative;\r\n    }\r\n    .form-t /deep/ .el-form-item{\r\n        /*position: absolute;*/\r\n        /*top: 50%;*/\r\n        /*transform: translate(0, -50%);*/\r\n    }\r\n\r\n    .form-t .label-col {\r\n        text-align: right;\r\n        padding-right: 26px;\r\n        padding-bottom: 14px;\r\n    }\r\n\r\n    .form-t /deep/ .el-select {\r\n        width: 100%;\r\n    }\r\n    .form-t .upload-demo{\r\n        display: inline-block;\r\n    }\r\n    .form-t .btns{\r\n        text-align: center;\r\n    }\r\n    .form-t /deep/ .el-form-item__error {\r\n        /*margin-top: -10px;*/\r\n    }\r\n    .form-t /deep/ .el-col.textarea-row .el-form-item__error {\r\n        margin-top: 0;\r\n    }\r\n\r\n    .form-t .hidden-input {\r\n        display: none;\r\n    }\r\n</style>\r\n\r\n<!-- 图片上传样式 -->\r\n<style>\r\n    .form-t .file-tip{\r\n        font-size: 10px;\r\n        text-align: center;\r\n        height: 160px;\r\n        line-height: 160px;\r\n    }\r\n    .avatar-uploader .el-upload {\r\n        border: 1px dashed #d9d9d9;\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n        position: relative;\r\n        overflow: hidden;\r\n    }\r\n    .avatar-uploader /deep/ .el-upload {\r\n        position: absolute;\r\n        left: 50%;\r\n        transform: translate(-50%, 0);\r\n    }\r\n    .avatar-uploader .el-upload:hover {\r\n        border-color: #409EFF;\r\n    }\r\n    .avatar-uploader-icon {\r\n        font-size: 28px;\r\n        color: #8c939d;\r\n        width: 160px;\r\n        height: 160px;\r\n        line-height: 160px;\r\n        text-align: center;\r\n    }\r\n    .avatar {\r\n        width: 160px;\r\n        height: 160px;\r\n        display: block;\r\n    }\r\n</style>\r\n"]}]}