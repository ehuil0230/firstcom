{"remainingRequest":"D:\\vueWorkspace\\cyfz\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vueWorkspace\\cyfz\\src\\views\\xdqgl\\jxkh.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vueWorkspace\\cyfz\\src\\views\\xdqgl\\jxkh.vue","mtime":1571279237450},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport TableList from \"../../components/grid/TableList\";\nimport toolbar from \"@/components/toolbar/myToolbar\";\nimport cyUpload from \"../../components/upAndDown/cyUpload\";\n\nexport default {\n    name: \"jxkh\",\n    components: {\n        TableList,\n        toolbar,\n        cyUpload\n    },\n    data() {\n        return {\n            // form表单字段和label的宽度\n            formWidth: {\n                label: 6,\n                content: 18\n            },\n            //表单字段\n            pilotAreas: [\n\n            ],\n            columns: [\n                {\n                    label: '先导区名称',\n                    prop: 'pilotAreaName',\n                    template: true\n                },{\n                    label: '所在省份',\n                    prop: 'provinceName'\n                },{\n                    label: '发布人',\n                    prop: 'createUserName'\n                },{\n                    label: '发布部门',\n                    prop: 'createOrgName'\n                },{\n                    label: '发布时间',\n                    prop: 'createTime',\n                    formatter(row) {\n                        return new Date(row.createTime).Format(\"yyyy-MM-dd hh:mm:ss\")\n                    }\n                },{\n                    label: '状态',\n                    prop: 'state',\n                    formatter(row) {\n                        //更改工作流后状态值统一改为： 0/1 未发布   1-9(不包括)审核中   9已发布\n                        if (row.state <= 1) {\n                            return '未发布'\n                        } else if (row.state > 1 && row.state < 9) {\n                            return '审核中'\n                        } else if (row.state == 9) {\n                            return '已发布'\n                        } else {\n                            return '未发布'\n                        }\n                    }\n\n                }\n            ],\n            provinces: [\n\n            ],\n            state: [{\n                CAPTION: '已发布',\n                //CODE: 1\n                  CODE: 2   //更改工作流后状态值统一改为： 0/1 未发布   1-9(不包括)审核中   9已发布\n            },{\n                CAPTION: '未发布',\n                CODE: 0\n            }],\n            //查询时需获取页面数据\n            searchParams:{\n                pilotareaid: '',\n                // provinceDm:'',\n                state: ''\n            },\n            rules: {\n                pilotareaid: [\n                    { required: true, message: '请选择先导区'}\n                ],\n                provinceName: [\n                    { required: true, message: '所在省份不能为空'}\n                ],\n                introduction: [\n                    { required: true, message: '请填写考核说明'},\n                    { max: 200, message: '长度在200个字符串'}\n                ],\n                // uploadFile: [\n                //     { required: true, message: '请上传绩效考核总结'}\n                // ],\n            },\n            //调用组件传输返回页面数据\n            getDataWay:{\n                dataType:\"url\",\n                data: this.$api.xdqglApi.pilotAssessQuery,\n                param: {}\n            },\n            pagination:{\n                // currentPage: 1,\n                // pageSize: 10,\n                // position: 'right',\n                // layout: 'total,prev, pager, next, jumper'\n                currentPage: 1,\n                pageSize: 10,\n                position: 'center',\n                pageSizes: [10, 50, 100],//默认每页显示多少条\n                layout: 'sizes ,prev, pager, next, jumper'\n            },\n            toolbarItem:[\n                {\n                    type:\"primary\",\n                    title:\"新建\",\n                    icon:\"el-icon-edit-outline\",\n                    disabled:false,\n                    click:\"create\"\n                },\n                {\n                    type:\"primary\",\n                    title:\"修改\",\n                    icon:\"el-icon-edit\",\n                    disabled:false,\n                    click:\"update\"\n                },\n                {\n                    type:\"primary\",\n                    title:\"删除\",\n                    icon:\"el-icon-delete\",\n                    disabled:false,\n                    click:\"delete\"\n                },{\n                    type:\"primary\",\n                    title:\"搜索\",\n                    icon:\"el-icon-search\",\n                    disabled:false,\n                    click:\"search\"\n                },\n            ],\n            //新建表单字段\n            form: {\n                uuid: '',\n                pilotareaid: '',\n                pilotAreaName:'',//先导区名称\n                provinceDm: '',//所在省份\n                provinceName: '',\n                introduction : '',\n                // createOrg: '',\n                // createOrgName: '',\n                uploadFile: '',\n                state: ''\n            },\n            fileData: {\n                fileNum: 100,\n                relatedId: '',\n                allowUpload: true,\n                fromType: '0001',\n                spType: '010001'\n            },\n            //点击工具栏跳转\n            dialogVisible: false,\n            checkedData:[],\n            ids:[],\n            // fileList是首次加载的文件列表，用于和$ref.upload.fileList对比\n            // 是否有新文件上传\n            fileList:[]\n        }\n    },\n    methods: {\n        initData() {\n            const that = this\n            // 请求省份码表\n            this.$$request({\n                method: 'post',\n                url: this.$api.getCodeData,\n                data: {\n                    tableName : \"DM_PROVINCE\"\n                }\n            }).then(function (res) {\n                if (res.result === 1) {\n                    that.provinces = res.info\n                }else {\n                    that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\n                    return false\n                }\n            }).catch(function (error) {\n                that.$alert(error, \"系统异常，请联系管理员！\", {})\n                return false\n            })\n\n            // 请求先导区表\n            this.$$request({\n                method: 'post',\n                url: this.$api.xdqglApi.pilotAreaQuery,\n                data: {\n                    \"pageSizeZero\":\"true\",\n                    \"pageSize\":0\n                }\n            }).then(function (res) {\n                if (res.result === 1) {\n                    that.pilotAreas = res.info.list\n                }else {\n                    that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\n                    return false\n                }\n            }).catch(function (error) {\n                that.$alert(error, \"系统异常，请联系管理员！\", {})\n                return false\n            })\n        },\n        // 打开dialog\n        openDailog() {\n\n        },\n        //关闭dialog\n        close() {\n            this.dialogVisible = false;\n        },\n        toolbarClick(item) {\n            let that = this;\n            if (item.title == '新建') {\n                /*新建初始化*/\n                this.dialogVisible = true\n                this.$nextTick(function(){\n                    that.$refs['jxkhForm'].resetFields()\n                    that.form.uuid = ''\n                    that.form.pilotareaid = ''\n                    that.form.pilotAreaName = ''//先导区名称\n                    that.form.provinceDm = ''//所在省份\n                    that.form.provinceName =  ''\n                    that.form.introduction = ''\n                    that.form.uploadFile = ''\n                    that.form.state = ''\n\n                    // 文件上传数据\n                    that.fileData.relatedId = ''\n                    that.$refs.upload.fileList = []\n                })\n            }\n            if(item.title == '修改'){\n                /*修改初始化*/\n                if(this.checkedData.length === 0 || this.checkedData.length > 1){\n                    this.$alert('请选择一条数据进行修改！', '提示',{\n                        type: 'warning'\n                    })\n                }else{\n                    let state = this.checkedData[0].state\n                    //更改工作流后状态值统一改为： 0/1 未发布   1-9(不包括)审核中   9已发布\n                    if (state > 1 && state < 9) {\n                        this.$alert('审核状态中无法修改！', '提示', {\n                            type: 'warning'\n                        })\n                        return false\n                    } else if(state == 9){\n                        this.$alert('已发布内容无法修改！', '提示', {\n                            type: 'warning'\n                        })\n                        return false\n                    }else if(this.checkedData.editFlag===0){       //添加登录人操作权限限制\n                        this.$alert('当前登录人不具有修改权限！', '提示', {\n                            type: 'warning'\n                        })\n                        return false\n                    }\n\n                    this.$$request({\n                        method: 'post',\n                        url: this.$api.xdqglApi.pilotAssessDetail,\n                        data: {\n                            uuid : this.checkedData[0].uuid\n                        }\n                    }).then(function (res) {\n                        if (res.result === 1) {\n                            that.dialogVisible = true\n\n                            // 初始化文件上传\n                            that.$nextTick(function(){\n                                that.$refs.upload.fileList = []\n                                that.form = res.info\n                                // 文件上传数据\n                                that.fileData.relatedId = that.form.uuid\n                                this.$$queryFileList({\n                                    \"relatedid\": that.checkedData[0].uuid\n                                }).then((res) => {\n                                    return res.infoe\n                                }).then((data) => {\n                                    if (data.length > 0) {\n                                        data.forEach((item) => {\n                                            let obj = {\n                                                relatedid: item.relatedid,\n                                                uuid: item.uuid,\n                                                name: item.fileName,\n                                                url: item.md5path,\n                                            };\n                                            that.$refs.upload.fileList.push(obj);\n                                        })\n                                        // fileList是首次加载的文件列表，用于之后对比\n                                        that.fileList = that.$refs.upload.fileList\n                                    }\n                                }).catch(function (err) {\n                                })\n                            })\n                        }else {\n                            that.$alert(res.msg, \"系统异常，请联系管理员！\", {});\n                            return false;\n                        }\n                    }).catch(function (error) {\n                        that.$alert(error, \"系统异常，请联系管理员！\", {});\n                        return false;\n                    });\n                }\n            }\n            if(item.title=='删除'){\n                if(this.checkedData.length === 0){\n                    this.$alert('请选择至少一条数据进行删除！', '提示',{\n                        type: 'warning'\n                    })\n                }else {\n                    for (let i=0; i<this.checkedData.length; i++) {\n                        //更改工作流后状态值统一改为： 0/1 未发布   1-9(不包括)审核中   9已发布\n                        if (this.checkedData[i].state > 1) {\n                            this.$alert('审核中或已发布的无法删除！', '提示',{\n                                type: 'warning'\n                            })\n                            return false\n                        }\n                        //添加登录人操作权限限制\n                        if(this.checkedData[i].editFlag===0){\n                            this.$alert('当前登录人不具有修改权限！', '提示', {\n                                type: 'warning'\n                            })\n                            return false\n                        }\n                    }\n\n                    this.$confirm('确认删除?', '提示', {\n                        confirmButtonText: '确定',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        let uuids = this.ids.join(',')\n                        this.$$request({\n                            method: 'post',\n                            url: this.$api.xdqglApi.pilotAssessDelete,\n                            data: {\n                                uuid : uuids\n                            }\n                        }).then(function (res) {\n                            if (res.result == 1) {\n                                that.$message({\n                                    type: 'success',\n                                    message: '删除成功!'\n                                });\n                                that.checkedData = []\n                                that.ids = []\n                                that.$refs.table.loadData()\n                            } else {\n                                that.$message({\n                                    type: 'warning',\n                                    message: '删除失败!'\n                                });\n                            }\n                        })\n                    }).catch(() => {\n                        that.$message({\n                            type: 'info',\n                            message: '已取消删除'\n                        });\n                    });\n                }\n            }\n            if(item.title=='搜索'){\n                // window.console.log(...this.searchParams)\n                that.$refs.table.loadData(this.searchParams)\n                that.checkedData = []\n                that.ids = []\n            }\n        },\n        // 统一保存方法，保存和提交都会调用\n        uniformSave(formName){\n            // 首先判断状态，审批完成后无法修改\n            if (this.form.state > 0 && this.form.state < 9) {\n                this.$alert('审核状态中无法修改！', '提示', {\n                    type: 'warning'\n                })\n                return false\n            }else if (this.form.state == 9) {\n                this.$alert('已发布内容无法修改！', '提示', {\n                    type: 'warning'\n                })\n                return false\n            }\n\n            let that = this\n            let url = ''\n            let data = {\n                ...this.form\n            }\n            if ($.isNotEmpty(this.form.uuid)) {\n                // 修改\n                url = this.$api.xdqglApi.pilotAssessUpdate\n                data.uuid = this.form.uuid\n            } else {\n                // 新增\n                url = this.$api.xdqglApi.pilotAssessSave\n            }\n            let saveRequestPromise = null\n            this.$refs[formName].validate((valid) => {\n                // 表单验证通过\n                if (valid) {\n                    const promise = that.$$request({\n                        method: 'post',\n                        url: url,\n                        data: data\n                    }).then(function (res) {\n                        if (res.result === 1) {\n                            that.form.uuid = res.info.uuid\n                            return res\n                        }else {\n                            that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\n                            return false\n                        }\n                    }).then(function (res) {\n                        // 保存成功后，检查是否需要上传附件\n                        let res1 = res\n                        // 只有新增才需要单独处理上传，修改不需要\n                        if (res1 && url == that.$api.xdqglApi.pilotAssessSave) {\n                            const param = that.buildToUploadFile(res)\n                            if (Object.keys(param).length != 0) {\n                                that.$$insertFileInfoBatch(param).\n                                then((resdata) => {\n                                    res1 = resdata\n                                }).catch(function (err) {\n                                    that.$message({\n                                        message: '关联附件列表失败',\n                                        type: 'warning'\n                                    })\n                                })\n                            }\n                        }\n                        return res1\n                    })\n                    saveRequestPromise = promise\n                }else {\n                    window.console.log('验证未通过!')\n                    return false\n                }\n            })\n            return saveRequestPromise\n        },\n        // 检测是否有新附件需要上传\n        buildToUploadFile(res) {\n            const that = this\n            let param = {}\n            let MD5Paths = [], fileNames = []\n            let newFileList = that.$refs.upload.fileList\n            // 比对新旧文件，新文件才需要上传\n            if (newFileList.length > 0) {\n                newFileList.forEach((outerItem) => {\n                    let flag = true\n                    for (let i=0; i<that.fileList.length; i++) {\n                        let innerItem = that.fileList[i]\n                        if (outerItem.url == innerItem.url &&\n                            outerItem.name == innerItem.name) {\n                            flag = false\n                            break\n                        }\n                    }\n                    // 原文件列表中不存在文件，是新文件\n                    if (flag) {\n                        // 不要重复添加\n                        if (MD5Paths.indexOf(outerItem.url) == -1) {\n                            MD5Paths.push(outerItem.url)\n                            fileNames.push(outerItem.name)\n                        }\n                    }\n                })\n                param = {\n                    \"relatedid\": res.info.uuid,\n                    \"MD5Path\": MD5Paths.join(','),\n                    \"fileName\": fileNames.join(',')\n                }\n            } else {\n                that.$message({\n                    message: '新增成功',\n                    type: 'success'\n                })\n            }\n            return param\n        },\n        // 保存\n        onSave(formName) {\n            // let that = this\n            // let url = ''\n            // let data = {\n            //     ...this.form\n            // }\n            // let successTip = ''\n            // if ($.isNotEmpty(this.form.uuid)) {\n            //     // 修改\n            //     url = this.$api.xdqglApi.pilotAssessUpdate\n            //     data.uuid = this.form.uuid\n            //     successTip = '修改成功'\n            // } else {\n            //     // 新增\n            //     url = this.$api.xdqglApi.pilotAssessSave\n            //     successTip = '保存成功'\n            // }\n            // this.$refs[formName].validate((valid) => {\n            //     // 表单验证通过\n            //     if (valid) {\n            //         this.$$request({\n            //             method: 'post',\n            //             url: url,\n            //             data: data\n            //         }).then(function (res) {\n            //             if (res.result === 1) {\n            //                 that.$alert(successTip, '提示', {\n            //                     type: 'success'\n            //                 })\n            //                 that.dialogVisible = false\n            //                 that.$refs[formName].resetFields()\n            //                 that.$refs.table.loadData()\n            //                 that.checkedData = []\n            //                 that.ids = []\n            //             }else {\n            //                 that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\n            //                 return false\n            //             }\n            //         }).catch(function (error) {\n            //             that.$alert(error, \"系统异常，请联系管理员！\", {})\n            //             return false\n            //         })\n            //     }else {\n            //         window.console.log('验证未通过!')\n            //         return false\n            //     }\n            // })\n            let that = this\n            let successTip = ''\n            if ($.isNotEmpty(this.form.uuid)) {\n                // 修改\n                successTip = '修改成功'\n            } else {\n                // 新增\n                successTip = '保存成功'\n            }\n            const savePromise = this.uniformSave(formName)\n            if (savePromise instanceof Promise) {\n                savePromise.then((res) => {\n                    if (res.result === 1) {\n                        that.$alert(successTip, '提示', {\n                            type: 'success'\n                        })\n                        that.dialogVisible = false\n                        that.$refs[formName].resetFields()\n                        that.$refs.table.loadData()\n                        that.checkedData = []\n                        that.ids = []\n                    }\n                }).catch((error) => {\n                    that.$alert(error, \"保存时出现异常，请联系管理员！\", {})\n                    return false\n                })\n            }\n        },\n        //提交表单\n        onSubmit(formName) {\n            let that = this\n            let url = that.$api.xdqglApi.uniformSubmit\n            let successTip = '提交成功'\n            let approvalDm = '010007' // 审核代码\n            const savePromise = this.uniformSave(formName)\n            if (savePromise instanceof Promise) {\n                savePromise.then((res) => {\n                    if (res.result === 1) {\n                        that.form.tableid = that.form.uuid\n                        that.form.uuid = ''\n                        let data = {\n                            ...that.form,\n                            approvalDm: approvalDm\n                        }\n                        this.$$request({\n                            method: 'post',\n                            url: url,\n                            data: data\n                        }).then(function (res) {\n                            if (res.result === 1) {\n                                that.$alert(successTip, '提示', {\n                                    type: 'success'\n                                })\n                                that.dialogVisible = false\n                                that.$refs[formName].resetFields()\n                                that.$refs.table.loadData()\n                                that.checkedData = []\n                                that.ids = []\n                            }else {\n                                that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\n                                return false\n                            }\n                        })\n                    }\n                }).catch((error) => {\n                    that.$alert(error, \"提交时出现异常，请联系管理员！\", {})\n                    return false\n                })\n            }\n        },\n        searchBtn() {\n\n        },\n        handlePreview() {\n\n        },\n        // 改变先导区下拉框选项，同步变更所在省份\n        changePilotArea(value){\n            const that = this\n            for (let i=0; i< this.pilotAreas.length; i++) {\n                if (this.pilotAreas[i].uuid == value){\n                    that.form.provinceName = this.pilotAreas[i].provinceName\n                    that.form.provinceDm = this.pilotAreas[i].provinceDm\n                    break\n                }\n            }\n        },\n        //点击标题跳转页面方法\n        selectJxkh(data) {\n            this.$router.push({\n                name: \"jxkhDetail\",\n                query: {\n                    uuid: data.uuid,\n                }\n            })\n        }\n    },\n    //加载页面前获取Mock数据\n    // beforeCreate: function () {\n    //     const that = this\n    //     this.$$request({\n    //         url: \"http://mockjs.com/api/jxkh\",\n    //         data: {type: 'top', key: '123456'}\n    //     }).then(function (res) {\n    //         that.getDataWay.data = res.info.list  //查询请求\n    //         that.$refs.table.loadData()  //数据加载\n    //     })\n    // },\n    mounted() {\n        this.initData()\n    },\n    watch:{\n        checkedData:function (val) {\n            this.ids=[];\n            for(let i=0; i<val.length ;i++) {\n                this.ids.push(val[i].uuid);\n            }\n        }\n    }\n}\n",{"version":3,"sources":["jxkh.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8HA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"jxkh.vue","sourceRoot":"src/views/xdqgl","sourcesContent":["<template>\r\n    <div class = \"myStyle\">\r\n    <div class=\"rightMain\">\r\n        <!--工具栏-->\r\n        <toolbar position=top :toolbarItem=\"toolbarItem\" @toolbarClick=\"toolbarClick\" center></toolbar>\r\n        <!--工具栏-新建-->\r\n        <screenFilter :searchParams=\"searchParams\">\r\n            <template slot=\"slot_two\">\r\n<!--                <el-input class=\"search-name\" size=\"small\" v-model=\"searchParams.pilotAreaName\"-->\r\n<!--                          placeholder=\"请输入先导区名称\" prefix-icon=\"el-icon-search\" @input=\"searchBtn\">-->\r\n<!--                </el-input>-->\r\n                <el-select class=\"search-name\" v-model=\"searchParams.pilotareaid\" placeholder=\"请选择先导区名称\">\r\n                    <el-option\r\n                            v-for=\"item in pilotAreas\"\r\n                            :key=\"item.uuid\"\r\n                            :label=\"item.pilotAreaName\"\r\n                            :value=\"item.uuid\">\r\n                    </el-option>\r\n                </el-select>\r\n            </template>\r\n            <template slot=\"slot_search\">\r\n                <el-form-item label=\"状态\">\r\n<!--                    <el-input v-model=\"searchParams.state\"></el-input>-->\r\n                    <el-select v-model=\"searchParams.state\" placeholder=\"请选择\">\r\n                        <el-option\r\n                                v-for=\"item in state\"\r\n                                :key=\"item.CODE\"\r\n                                :label=\"item.CAPTION\"\r\n                                :value=\"item.CODE\">\r\n                        </el-option>\r\n                    </el-select>\r\n                </el-form-item>\r\n            </template>\r\n        </screenFilter>\r\n        <tableList ref=\"table\"\r\n                   selection\r\n                   index\r\n                   style=\"border-top: none;text-align: center\"\r\n                   :getDataWay=\"getDataWay\"\r\n                   :columns=\"columns\"\r\n                   :pagination=\"pagination\"\r\n                   :checkedData.sync='checkedData'>\r\n            <el-table-column label=\"先导区名称\" slot=\"pilotAreaName\" show-overflow-tooltip>\r\n                <template slot-scope=\"scope\">\r\n                    <el-link :underline=\"false\" @click=\"selectJxkh(scope.row)\" class=\"a-link\">\r\n                        {{scope.row.pilotAreaName}}\r\n                    </el-link>\r\n                </template>\r\n            </el-table-column>\r\n        </tableList>\r\n        <el-dialog\r\n                title=\"绩效考核详情\"\r\n                :visible.sync=\"dialogVisible\"\r\n                :close-on-click-modal=\"false\"\r\n                :modal=\"true\"\r\n                v-dialogDrag\r\n                width=\"50%\"\r\n                :center=\"true\"\r\n                @open=\"openDailog\"\r\n                @close=\"close\">\r\n            <div class=\"form-t\" style=\"width:80% ; margin: 0 auto;\">\r\n                <el-form :rules=\"rules\" :model=\"form\" ref=\"jxkhForm\" label-width=\"90px\">\r\n                    <el-row>\r\n                        <el-col class=\"label-col\" :span=\"formWidth.label\">\r\n                            <label>先导区名称</label>\r\n                        </el-col>\r\n                        <el-col :span=\"formWidth.content\">\r\n                            <el-form-item prop=\"pilotareaid\">\r\n<!--                                <el-input v-model=\"form.pilotAreaName\"></el-input>-->\r\n                                <el-select v-model=\"form.pilotareaid\" placeholder=\"请选择先导区名称\"\r\n                                           @change=\"changePilotArea\">\r\n                                    <el-option\r\n                                            v-for=\"item in pilotAreas\"\r\n                                            :key=\"item.uuid\"\r\n                                            :label=\"item.pilotAreaName\"\r\n                                            :value=\"item.uuid\">\r\n                                    </el-option>\r\n                                </el-select>\r\n                            </el-form-item>\r\n                        </el-col>\r\n                    </el-row>\r\n                    <el-row>\r\n                        <el-col class=\"label-col\" :span=\"formWidth.label\">\r\n                            <label>所在省份</label>\r\n                        </el-col>\r\n                        <el-col :span=\"formWidth.content\">\r\n                            <el-form-item prop=\"provinceName\">\r\n                                <el-input disabled v-model=\"form.provinceName\"></el-input>\r\n                            </el-form-item>\r\n                        </el-col>\r\n                    </el-row>\r\n                    <el-row>\r\n                        <el-col class=\"label-col textarea-row\" :span=\"formWidth.label\">\r\n                            <label>考核说明</label>\r\n                        </el-col>\r\n                        <el-col class=\"textarea-row\" :span=\"formWidth.content\">\r\n                            <el-form-item prop=\"introduction\">\r\n                                <el-input type=\"textarea\" v-model=\"form.introduction\"></el-input>\r\n                            </el-form-item>\r\n                        </el-col>\r\n                    </el-row>\r\n                    <el-row>\r\n                        <el-col class=\"label-col\" :span=\"formWidth.label\">\r\n                            <label>绩效考核总结</label>\r\n                        </el-col>\r\n                        <el-col :span=\"formWidth.content\">\r\n                            <el-form-item prop=\"fj\">\r\n                                <cy-upload ref=\"upload\" v-if=\"fileData.allowUpload\"\r\n                                           :file-num=\"fileData.fileNum\" :auto-up=\"true\"\r\n                                           :relatedId=\"fileData.relatedId\">\r\n                                </cy-upload>\r\n                            </el-form-item>\r\n                        </el-col>\r\n                    </el-row>\r\n                </el-form>\r\n            </div>\r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n                <el-button type=\"primary\" @click=\"onSave('jxkhForm')\">保存</el-button>\r\n                <el-button @click=\"onSubmit('jxkhForm')\">提交</el-button>\r\n            </span>\r\n        </el-dialog>\r\n    </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import TableList from \"../../components/grid/TableList\";\r\n    import toolbar from \"@/components/toolbar/myToolbar\";\r\n    import cyUpload from \"../../components/upAndDown/cyUpload\";\r\n\r\n    export default {\r\n        name: \"jxkh\",\r\n        components: {\r\n            TableList,\r\n            toolbar,\r\n            cyUpload\r\n        },\r\n        data() {\r\n            return {\r\n                // form表单字段和label的宽度\r\n                formWidth: {\r\n                    label: 6,\r\n                    content: 18\r\n                },\r\n                //表单字段\r\n                pilotAreas: [\r\n\r\n                ],\r\n                columns: [\r\n                    {\r\n                        label: '先导区名称',\r\n                        prop: 'pilotAreaName',\r\n                        template: true\r\n                    },{\r\n                        label: '所在省份',\r\n                        prop: 'provinceName'\r\n                    },{\r\n                        label: '发布人',\r\n                        prop: 'createUserName'\r\n                    },{\r\n                        label: '发布部门',\r\n                        prop: 'createOrgName'\r\n                    },{\r\n                        label: '发布时间',\r\n                        prop: 'createTime',\r\n                        formatter(row) {\r\n                            return new Date(row.createTime).Format(\"yyyy-MM-dd hh:mm:ss\")\r\n                        }\r\n                    },{\r\n                        label: '状态',\r\n                        prop: 'state',\r\n                        formatter(row) {\r\n                            //更改工作流后状态值统一改为： 0/1 未发布   1-9(不包括)审核中   9已发布\r\n                            if (row.state <= 1) {\r\n                                return '未发布'\r\n                            } else if (row.state > 1 && row.state < 9) {\r\n                                return '审核中'\r\n                            } else if (row.state == 9) {\r\n                                return '已发布'\r\n                            } else {\r\n                                return '未发布'\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                ],\r\n                provinces: [\r\n\r\n                ],\r\n                state: [{\r\n                    CAPTION: '已发布',\r\n                    //CODE: 1\r\n                      CODE: 2   //更改工作流后状态值统一改为： 0/1 未发布   1-9(不包括)审核中   9已发布\r\n                },{\r\n                    CAPTION: '未发布',\r\n                    CODE: 0\r\n                }],\r\n                //查询时需获取页面数据\r\n                searchParams:{\r\n                    pilotareaid: '',\r\n                    // provinceDm:'',\r\n                    state: ''\r\n                },\r\n                rules: {\r\n                    pilotareaid: [\r\n                        { required: true, message: '请选择先导区'}\r\n                    ],\r\n                    provinceName: [\r\n                        { required: true, message: '所在省份不能为空'}\r\n                    ],\r\n                    introduction: [\r\n                        { required: true, message: '请填写考核说明'},\r\n                        { max: 200, message: '长度在200个字符串'}\r\n                    ],\r\n                    // uploadFile: [\r\n                    //     { required: true, message: '请上传绩效考核总结'}\r\n                    // ],\r\n                },\r\n                //调用组件传输返回页面数据\r\n                getDataWay:{\r\n                    dataType:\"url\",\r\n                    data: this.$api.xdqglApi.pilotAssessQuery,\r\n                    param: {}\r\n                },\r\n                pagination:{\r\n                    // currentPage: 1,\r\n                    // pageSize: 10,\r\n                    // position: 'right',\r\n                    // layout: 'total,prev, pager, next, jumper'\r\n                    currentPage: 1,\r\n                    pageSize: 10,\r\n                    position: 'center',\r\n                    pageSizes: [10, 50, 100],//默认每页显示多少条\r\n                    layout: 'sizes ,prev, pager, next, jumper'\r\n                },\r\n                toolbarItem:[\r\n                    {\r\n                        type:\"primary\",\r\n                        title:\"新建\",\r\n                        icon:\"el-icon-edit-outline\",\r\n                        disabled:false,\r\n                        click:\"create\"\r\n                    },\r\n                    {\r\n                        type:\"primary\",\r\n                        title:\"修改\",\r\n                        icon:\"el-icon-edit\",\r\n                        disabled:false,\r\n                        click:\"update\"\r\n                    },\r\n                    {\r\n                        type:\"primary\",\r\n                        title:\"删除\",\r\n                        icon:\"el-icon-delete\",\r\n                        disabled:false,\r\n                        click:\"delete\"\r\n                    },{\r\n                        type:\"primary\",\r\n                        title:\"搜索\",\r\n                        icon:\"el-icon-search\",\r\n                        disabled:false,\r\n                        click:\"search\"\r\n                    },\r\n                ],\r\n                //新建表单字段\r\n                form: {\r\n                    uuid: '',\r\n                    pilotareaid: '',\r\n                    pilotAreaName:'',//先导区名称\r\n                    provinceDm: '',//所在省份\r\n                    provinceName: '',\r\n                    introduction : '',\r\n                    // createOrg: '',\r\n                    // createOrgName: '',\r\n                    uploadFile: '',\r\n                    state: ''\r\n                },\r\n                fileData: {\r\n                    fileNum: 100,\r\n                    relatedId: '',\r\n                    allowUpload: true,\r\n                    fromType: '0001',\r\n                    spType: '010001'\r\n                },\r\n                //点击工具栏跳转\r\n                dialogVisible: false,\r\n                checkedData:[],\r\n                ids:[],\r\n                // fileList是首次加载的文件列表，用于和$ref.upload.fileList对比\r\n                // 是否有新文件上传\r\n                fileList:[]\r\n            }\r\n        },\r\n        methods: {\r\n            initData() {\r\n                const that = this\r\n                // 请求省份码表\r\n                this.$$request({\r\n                    method: 'post',\r\n                    url: this.$api.getCodeData,\r\n                    data: {\r\n                        tableName : \"DM_PROVINCE\"\r\n                    }\r\n                }).then(function (res) {\r\n                    if (res.result === 1) {\r\n                        that.provinces = res.info\r\n                    }else {\r\n                        that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\r\n                        return false\r\n                    }\r\n                }).catch(function (error) {\r\n                    that.$alert(error, \"系统异常，请联系管理员！\", {})\r\n                    return false\r\n                })\r\n\r\n                // 请求先导区表\r\n                this.$$request({\r\n                    method: 'post',\r\n                    url: this.$api.xdqglApi.pilotAreaQuery,\r\n                    data: {\r\n                        \"pageSizeZero\":\"true\",\r\n                        \"pageSize\":0\r\n                    }\r\n                }).then(function (res) {\r\n                    if (res.result === 1) {\r\n                        that.pilotAreas = res.info.list\r\n                    }else {\r\n                        that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\r\n                        return false\r\n                    }\r\n                }).catch(function (error) {\r\n                    that.$alert(error, \"系统异常，请联系管理员！\", {})\r\n                    return false\r\n                })\r\n            },\r\n            // 打开dialog\r\n            openDailog() {\r\n\r\n            },\r\n            //关闭dialog\r\n            close() {\r\n                this.dialogVisible = false;\r\n            },\r\n            toolbarClick(item) {\r\n                let that = this;\r\n                if (item.title == '新建') {\r\n                    /*新建初始化*/\r\n                    this.dialogVisible = true\r\n                    this.$nextTick(function(){\r\n                        that.$refs['jxkhForm'].resetFields()\r\n                        that.form.uuid = ''\r\n                        that.form.pilotareaid = ''\r\n                        that.form.pilotAreaName = ''//先导区名称\r\n                        that.form.provinceDm = ''//所在省份\r\n                        that.form.provinceName =  ''\r\n                        that.form.introduction = ''\r\n                        that.form.uploadFile = ''\r\n                        that.form.state = ''\r\n\r\n                        // 文件上传数据\r\n                        that.fileData.relatedId = ''\r\n                        that.$refs.upload.fileList = []\r\n                    })\r\n                }\r\n                if(item.title == '修改'){\r\n                    /*修改初始化*/\r\n                    if(this.checkedData.length === 0 || this.checkedData.length > 1){\r\n                        this.$alert('请选择一条数据进行修改！', '提示',{\r\n                            type: 'warning'\r\n                        })\r\n                    }else{\r\n                        let state = this.checkedData[0].state\r\n                        //更改工作流后状态值统一改为： 0/1 未发布   1-9(不包括)审核中   9已发布\r\n                        if (state > 1 && state < 9) {\r\n                            this.$alert('审核状态中无法修改！', '提示', {\r\n                                type: 'warning'\r\n                            })\r\n                            return false\r\n                        } else if(state == 9){\r\n                            this.$alert('已发布内容无法修改！', '提示', {\r\n                                type: 'warning'\r\n                            })\r\n                            return false\r\n                        }else if(this.checkedData.editFlag===0){       //添加登录人操作权限限制\r\n                            this.$alert('当前登录人不具有修改权限！', '提示', {\r\n                                type: 'warning'\r\n                            })\r\n                            return false\r\n                        }\r\n\r\n                        this.$$request({\r\n                            method: 'post',\r\n                            url: this.$api.xdqglApi.pilotAssessDetail,\r\n                            data: {\r\n                                uuid : this.checkedData[0].uuid\r\n                            }\r\n                        }).then(function (res) {\r\n                            if (res.result === 1) {\r\n                                that.dialogVisible = true\r\n\r\n                                // 初始化文件上传\r\n                                that.$nextTick(function(){\r\n                                    that.$refs.upload.fileList = []\r\n                                    that.form = res.info\r\n                                    // 文件上传数据\r\n                                    that.fileData.relatedId = that.form.uuid\r\n                                    this.$$queryFileList({\r\n                                        \"relatedid\": that.checkedData[0].uuid\r\n                                    }).then((res) => {\r\n                                        return res.infoe\r\n                                    }).then((data) => {\r\n                                        if (data.length > 0) {\r\n                                            data.forEach((item) => {\r\n                                                let obj = {\r\n                                                    relatedid: item.relatedid,\r\n                                                    uuid: item.uuid,\r\n                                                    name: item.fileName,\r\n                                                    url: item.md5path,\r\n                                                };\r\n                                                that.$refs.upload.fileList.push(obj);\r\n                                            })\r\n                                            // fileList是首次加载的文件列表，用于之后对比\r\n                                            that.fileList = that.$refs.upload.fileList\r\n                                        }\r\n                                    }).catch(function (err) {\r\n                                    })\r\n                                })\r\n                            }else {\r\n                                that.$alert(res.msg, \"系统异常，请联系管理员！\", {});\r\n                                return false;\r\n                            }\r\n                        }).catch(function (error) {\r\n                            that.$alert(error, \"系统异常，请联系管理员！\", {});\r\n                            return false;\r\n                        });\r\n                    }\r\n                }\r\n                if(item.title=='删除'){\r\n                    if(this.checkedData.length === 0){\r\n                        this.$alert('请选择至少一条数据进行删除！', '提示',{\r\n                            type: 'warning'\r\n                        })\r\n                    }else {\r\n                        for (let i=0; i<this.checkedData.length; i++) {\r\n                            //更改工作流后状态值统一改为： 0/1 未发布   1-9(不包括)审核中   9已发布\r\n                            if (this.checkedData[i].state > 1) {\r\n                                this.$alert('审核中或已发布的无法删除！', '提示',{\r\n                                    type: 'warning'\r\n                                })\r\n                                return false\r\n                            }\r\n                            //添加登录人操作权限限制\r\n                            if(this.checkedData[i].editFlag===0){\r\n                                this.$alert('当前登录人不具有修改权限！', '提示', {\r\n                                    type: 'warning'\r\n                                })\r\n                                return false\r\n                            }\r\n                        }\r\n\r\n                        this.$confirm('确认删除?', '提示', {\r\n                            confirmButtonText: '确定',\r\n                            cancelButtonText: '取消',\r\n                            type: 'warning'\r\n                        }).then(() => {\r\n                            let uuids = this.ids.join(',')\r\n                            this.$$request({\r\n                                method: 'post',\r\n                                url: this.$api.xdqglApi.pilotAssessDelete,\r\n                                data: {\r\n                                    uuid : uuids\r\n                                }\r\n                            }).then(function (res) {\r\n                                if (res.result == 1) {\r\n                                    that.$message({\r\n                                        type: 'success',\r\n                                        message: '删除成功!'\r\n                                    });\r\n                                    that.checkedData = []\r\n                                    that.ids = []\r\n                                    that.$refs.table.loadData()\r\n                                } else {\r\n                                    that.$message({\r\n                                        type: 'warning',\r\n                                        message: '删除失败!'\r\n                                    });\r\n                                }\r\n                            })\r\n                        }).catch(() => {\r\n                            that.$message({\r\n                                type: 'info',\r\n                                message: '已取消删除'\r\n                            });\r\n                        });\r\n                    }\r\n                }\r\n                if(item.title=='搜索'){\r\n                    // window.console.log(...this.searchParams)\r\n                    that.$refs.table.loadData(this.searchParams)\r\n                    that.checkedData = []\r\n                    that.ids = []\r\n                }\r\n            },\r\n            // 统一保存方法，保存和提交都会调用\r\n            uniformSave(formName){\r\n                // 首先判断状态，审批完成后无法修改\r\n                if (this.form.state > 0 && this.form.state < 9) {\r\n                    this.$alert('审核状态中无法修改！', '提示', {\r\n                        type: 'warning'\r\n                    })\r\n                    return false\r\n                }else if (this.form.state == 9) {\r\n                    this.$alert('已发布内容无法修改！', '提示', {\r\n                        type: 'warning'\r\n                    })\r\n                    return false\r\n                }\r\n\r\n                let that = this\r\n                let url = ''\r\n                let data = {\r\n                    ...this.form\r\n                }\r\n                if ($.isNotEmpty(this.form.uuid)) {\r\n                    // 修改\r\n                    url = this.$api.xdqglApi.pilotAssessUpdate\r\n                    data.uuid = this.form.uuid\r\n                } else {\r\n                    // 新增\r\n                    url = this.$api.xdqglApi.pilotAssessSave\r\n                }\r\n                let saveRequestPromise = null\r\n                this.$refs[formName].validate((valid) => {\r\n                    // 表单验证通过\r\n                    if (valid) {\r\n                        const promise = that.$$request({\r\n                            method: 'post',\r\n                            url: url,\r\n                            data: data\r\n                        }).then(function (res) {\r\n                            if (res.result === 1) {\r\n                                that.form.uuid = res.info.uuid\r\n                                return res\r\n                            }else {\r\n                                that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\r\n                                return false\r\n                            }\r\n                        }).then(function (res) {\r\n                            // 保存成功后，检查是否需要上传附件\r\n                            let res1 = res\r\n                            // 只有新增才需要单独处理上传，修改不需要\r\n                            if (res1 && url == that.$api.xdqglApi.pilotAssessSave) {\r\n                                const param = that.buildToUploadFile(res)\r\n                                if (Object.keys(param).length != 0) {\r\n                                    that.$$insertFileInfoBatch(param).\r\n                                    then((resdata) => {\r\n                                        res1 = resdata\r\n                                    }).catch(function (err) {\r\n                                        that.$message({\r\n                                            message: '关联附件列表失败',\r\n                                            type: 'warning'\r\n                                        })\r\n                                    })\r\n                                }\r\n                            }\r\n                            return res1\r\n                        })\r\n                        saveRequestPromise = promise\r\n                    }else {\r\n                        window.console.log('验证未通过!')\r\n                        return false\r\n                    }\r\n                })\r\n                return saveRequestPromise\r\n            },\r\n            // 检测是否有新附件需要上传\r\n            buildToUploadFile(res) {\r\n                const that = this\r\n                let param = {}\r\n                let MD5Paths = [], fileNames = []\r\n                let newFileList = that.$refs.upload.fileList\r\n                // 比对新旧文件，新文件才需要上传\r\n                if (newFileList.length > 0) {\r\n                    newFileList.forEach((outerItem) => {\r\n                        let flag = true\r\n                        for (let i=0; i<that.fileList.length; i++) {\r\n                            let innerItem = that.fileList[i]\r\n                            if (outerItem.url == innerItem.url &&\r\n                                outerItem.name == innerItem.name) {\r\n                                flag = false\r\n                                break\r\n                            }\r\n                        }\r\n                        // 原文件列表中不存在文件，是新文件\r\n                        if (flag) {\r\n                            // 不要重复添加\r\n                            if (MD5Paths.indexOf(outerItem.url) == -1) {\r\n                                MD5Paths.push(outerItem.url)\r\n                                fileNames.push(outerItem.name)\r\n                            }\r\n                        }\r\n                    })\r\n                    param = {\r\n                        \"relatedid\": res.info.uuid,\r\n                        \"MD5Path\": MD5Paths.join(','),\r\n                        \"fileName\": fileNames.join(',')\r\n                    }\r\n                } else {\r\n                    that.$message({\r\n                        message: '新增成功',\r\n                        type: 'success'\r\n                    })\r\n                }\r\n                return param\r\n            },\r\n            // 保存\r\n            onSave(formName) {\r\n                // let that = this\r\n                // let url = ''\r\n                // let data = {\r\n                //     ...this.form\r\n                // }\r\n                // let successTip = ''\r\n                // if ($.isNotEmpty(this.form.uuid)) {\r\n                //     // 修改\r\n                //     url = this.$api.xdqglApi.pilotAssessUpdate\r\n                //     data.uuid = this.form.uuid\r\n                //     successTip = '修改成功'\r\n                // } else {\r\n                //     // 新增\r\n                //     url = this.$api.xdqglApi.pilotAssessSave\r\n                //     successTip = '保存成功'\r\n                // }\r\n                // this.$refs[formName].validate((valid) => {\r\n                //     // 表单验证通过\r\n                //     if (valid) {\r\n                //         this.$$request({\r\n                //             method: 'post',\r\n                //             url: url,\r\n                //             data: data\r\n                //         }).then(function (res) {\r\n                //             if (res.result === 1) {\r\n                //                 that.$alert(successTip, '提示', {\r\n                //                     type: 'success'\r\n                //                 })\r\n                //                 that.dialogVisible = false\r\n                //                 that.$refs[formName].resetFields()\r\n                //                 that.$refs.table.loadData()\r\n                //                 that.checkedData = []\r\n                //                 that.ids = []\r\n                //             }else {\r\n                //                 that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\r\n                //                 return false\r\n                //             }\r\n                //         }).catch(function (error) {\r\n                //             that.$alert(error, \"系统异常，请联系管理员！\", {})\r\n                //             return false\r\n                //         })\r\n                //     }else {\r\n                //         window.console.log('验证未通过!')\r\n                //         return false\r\n                //     }\r\n                // })\r\n                let that = this\r\n                let successTip = ''\r\n                if ($.isNotEmpty(this.form.uuid)) {\r\n                    // 修改\r\n                    successTip = '修改成功'\r\n                } else {\r\n                    // 新增\r\n                    successTip = '保存成功'\r\n                }\r\n                const savePromise = this.uniformSave(formName)\r\n                if (savePromise instanceof Promise) {\r\n                    savePromise.then((res) => {\r\n                        if (res.result === 1) {\r\n                            that.$alert(successTip, '提示', {\r\n                                type: 'success'\r\n                            })\r\n                            that.dialogVisible = false\r\n                            that.$refs[formName].resetFields()\r\n                            that.$refs.table.loadData()\r\n                            that.checkedData = []\r\n                            that.ids = []\r\n                        }\r\n                    }).catch((error) => {\r\n                        that.$alert(error, \"保存时出现异常，请联系管理员！\", {})\r\n                        return false\r\n                    })\r\n                }\r\n            },\r\n            //提交表单\r\n            onSubmit(formName) {\r\n                let that = this\r\n                let url = that.$api.xdqglApi.uniformSubmit\r\n                let successTip = '提交成功'\r\n                let approvalDm = '010007' // 审核代码\r\n                const savePromise = this.uniformSave(formName)\r\n                if (savePromise instanceof Promise) {\r\n                    savePromise.then((res) => {\r\n                        if (res.result === 1) {\r\n                            that.form.tableid = that.form.uuid\r\n                            that.form.uuid = ''\r\n                            let data = {\r\n                                ...that.form,\r\n                                approvalDm: approvalDm\r\n                            }\r\n                            this.$$request({\r\n                                method: 'post',\r\n                                url: url,\r\n                                data: data\r\n                            }).then(function (res) {\r\n                                if (res.result === 1) {\r\n                                    that.$alert(successTip, '提示', {\r\n                                        type: 'success'\r\n                                    })\r\n                                    that.dialogVisible = false\r\n                                    that.$refs[formName].resetFields()\r\n                                    that.$refs.table.loadData()\r\n                                    that.checkedData = []\r\n                                    that.ids = []\r\n                                }else {\r\n                                    that.$alert(res.msg, \"系统异常，请联系管理员！\", {})\r\n                                    return false\r\n                                }\r\n                            })\r\n                        }\r\n                    }).catch((error) => {\r\n                        that.$alert(error, \"提交时出现异常，请联系管理员！\", {})\r\n                        return false\r\n                    })\r\n                }\r\n            },\r\n            searchBtn() {\r\n\r\n            },\r\n            handlePreview() {\r\n\r\n            },\r\n            // 改变先导区下拉框选项，同步变更所在省份\r\n            changePilotArea(value){\r\n                const that = this\r\n                for (let i=0; i< this.pilotAreas.length; i++) {\r\n                    if (this.pilotAreas[i].uuid == value){\r\n                        that.form.provinceName = this.pilotAreas[i].provinceName\r\n                        that.form.provinceDm = this.pilotAreas[i].provinceDm\r\n                        break\r\n                    }\r\n                }\r\n            },\r\n            //点击标题跳转页面方法\r\n            selectJxkh(data) {\r\n                this.$router.push({\r\n                    name: \"jxkhDetail\",\r\n                    query: {\r\n                        uuid: data.uuid,\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        //加载页面前获取Mock数据\r\n        // beforeCreate: function () {\r\n        //     const that = this\r\n        //     this.$$request({\r\n        //         url: \"http://mockjs.com/api/jxkh\",\r\n        //         data: {type: 'top', key: '123456'}\r\n        //     }).then(function (res) {\r\n        //         that.getDataWay.data = res.info.list  //查询请求\r\n        //         that.$refs.table.loadData()  //数据加载\r\n        //     })\r\n        // },\r\n        mounted() {\r\n            this.initData()\r\n        },\r\n        watch:{\r\n            checkedData:function (val) {\r\n                this.ids=[];\r\n                for(let i=0; i<val.length ;i++) {\r\n                    this.ids.push(val[i].uuid);\r\n                }\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    .myStyle /deep/ .search-part2 el-col el-col-24{\r\n        width: 550px;\r\n    }\r\n    .myStyle /deep/ el-input__suffix{\r\n        right: 21px;\r\n    }\r\n    .myStyle /deep/ el-select>.el-input{\r\n        padding-right: 20px;\r\n    }\r\n    .rightMain {\r\n        margin: 10px auto;\r\n        width: 93%;\r\n    }\r\n\r\n    .form-t /deep/ .el-select {\r\n        width: 100%;\r\n    }\r\n    .form-t /deep/ .el-row{\r\n        margin-bottom: 10px;\r\n    }\r\n    .form-t /deep/ .el-col,\r\n    .form-t /deep/ .el-input{\r\n        position: relative;\r\n        height: 60px;\r\n        line-height: 60px;\r\n    }\r\n    .form-t /deep/ .el-col.textarea-row {\r\n        height: 74px;\r\n        line-height: 74px;\r\n    }\r\n    .form-t /deep/ .el-form-item{\r\n        position: absolute;\r\n        left: 0;\r\n        right: 0;\r\n        top: 50%;\r\n        transform: translate(0, -50%);\r\n    }\r\n\r\n    .form-t .label-col {\r\n        text-align: right;\r\n        padding-right: 26px;\r\n    }\r\n\r\n    .form-t /deep/ .el-form-item__content{\r\n        margin-left:0px !important;\r\n    }\r\n    .form-t /deep/ .el-form-item__error {\r\n        /*margin-top: -10px;*/\r\n    }\r\n</style>\r\n"]}]}