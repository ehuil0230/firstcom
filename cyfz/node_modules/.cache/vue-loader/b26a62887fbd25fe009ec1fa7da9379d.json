{"remainingRequest":"D:\\vueWorkspace\\cyfz\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vueWorkspace\\cyfz\\src\\components\\upAndDown\\cyUpload.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"D:\\vueWorkspace\\cyfz\\src\\components\\upAndDown\\cyUpload.vue","mtime":1570364116461},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\@vue\\cli-service\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.myupload .el-dialog__body {\n    padding: 10px 20px;\n    font-size: 16px;\n}\n\n.myupload .el-dialog__body-myi {\n    color: #EED46F;\n    margin-right: 20px;\n}\n\n.mytip {\n    font-size: 12px;\n    color: #909399;\n    margin: 3px;\n}\n\n",{"version":3,"sources":["cyUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuVA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"cyUpload.vue","sourceRoot":"src/components/upAndDown","sourcesContent":["<!---->\r\n<template>\r\n    <div class=\"myupload\">\r\n        <el-upload\r\n                ref=\"upload\"\r\n                action=\"#\"\r\n                :http-request=\"toUpload\"\r\n                :on-progress=\"toUploadProgress\"\r\n                :on-success=\"toUploadSuccess\"\r\n                :on-error=\"toUploadError\"\r\n                :on-preview=\"handlePreview\"\r\n                :on-exceed=\"handleExceed\"\r\n                :before-remove=\"beforeRemove\"\r\n                :on-remove=\"handleRemove\"\r\n                :file-list=\"fileList\"\r\n                :auto-upload=\"autoUp\"\r\n                :limit=\"fileNum\">\r\n            <el-button slot=\"trigger\" size=\"small\" type=\"primary\" icon=\"el-icon-circle-plus\">选取文件</el-button>\r\n            <el-button v-if=\"!autoUp\" style=\"margin-left: 10px;\" size=\"small\" type=\"success\"\r\n                       @click=\"submitUpload\"\r\n                       icon=\"el-icon-upload\">\r\n                上传文件\r\n            </el-button>\r\n            <div slot=\"tip\" class=\"mytip\">\r\n                <slot name=\"mytip\"></slot>\r\n            </div>\r\n        </el-upload>\r\n        <!--不使用默认展示方式，使用表格-->\r\n        <el-dialog title=\"提示\"\r\n                   :visible.sync=\"dialogVisible\"\r\n                   width=\"30%\"\r\n                   :close=\"dialogClose\">\r\n            <span><i class=\"el-icon-warning el-dialog__body-myi\"></i>对该文件进行下载？</span>\r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button size='small' type=\"primary\" @click=\"downloadFile\">文件下载</el-button>\r\n        <el-button size='small' @click=\"dialogVisible = false\">取 消</el-button>\r\n        </span>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n<script>\r\n    export default {\r\n        name: 'cyUpload',\r\n        props: {\r\n            autoUp: {//自动上传\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            fileNum: {\r\n                type: Number,\r\n                default: 10000,\r\n            },\r\n            relatedId: {\r\n                type: String,\r\n                default: '',\r\n            }\r\n        },\r\n        data() {\r\n            return {\r\n                dialogVisible: false,\r\n                fileList: [],\r\n            }\r\n        },\r\n        created() {\r\n            let that = this;\r\n            /*请求业务接口*/\r\n            if (this.relatedId !== \"\") {\r\n                this.$$queryFileList({\r\n                    \"relatedid\": this.relatedId\r\n                }).then((res) => {\r\n                    return res.info\r\n                }).then((data) => {\r\n                    if (data.length > 0) {\r\n                        data.forEach((item) => {\r\n                            let obj = {\r\n                                relatedid: item.relatedid,\r\n                                uuid: item.uuid,\r\n                                name: item.fileName,\r\n                                url: item.md5path,\r\n                            };\r\n                            that.fileList.push(obj);\r\n                        })\r\n                    }\r\n                }).catch(function (err) {\r\n                    that.$message({\r\n                        type: 'error',\r\n                        message: \"获取附件失败\"\r\n                    })\r\n                })\r\n            }\r\n        },\r\n        methods: {\r\n            submitUpload() {\r\n                this.$refs.upload.submit()\r\n            },\r\n            beforeUpload(file) {\r\n                // console.log(file)\r\n                /*if (this.listType === 'picture') {\r\n                    const isJPG = file.type === 'image/jpeg';\r\n                    const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n                    if (!isJPG) {\r\n                        this.$message.error('上传头像图片只能是 JPG 格式!');\r\n                    }\r\n                    if (!isLt2M) {\r\n                        this.$message.error('上传图片大小不能超过 2MB!');\r\n                    }\r\n                    return isJPG && isLt2M;\r\n                } else {\r\n                    return true\r\n                }*/\r\n            },\r\n            toUpload(params) {\r\n                let that = this;\r\n                that.$$md5ByFile(params).then((res) => {\r\n                    let defaultParam = {\r\n                        file: params.file,\r\n                        md5: res.md5\r\n                    };\r\n                    that.$$md5CheckByFile(Object.assign(defaultParam, that.md5CheckParams)).then((checkRes) => {\r\n                        if (checkRes && checkRes.message === \"正常上传\") {\r\n                            that.$$uploadFile(Object.assign(defaultParam, {\r\n                                progress: params.onProgress\r\n                            })).then(function (response) {\r\n                                let resObj = {\r\n                                    fileExt: response.fileExt,\r\n                                    secretKey: response.secretKey,\r\n                                    fileSize: response.fileSize,\r\n                                    name: response.fileSrcName,\r\n                                    url: response.url,\r\n                                    md5: response.md5,\r\n                                    relatedid: that.relatedId,\r\n                                };\r\n                                return resObj;\r\n                            }).then((resObj) => {\r\n                                if (this.relatedId !== \"\" && this.relatedId) {\r\n                                    let param = {\r\n                                        \"relatedid\": that.relatedId,\r\n                                        \"MD5Path\": resObj.url,\r\n                                        \"fileName\": resObj.name\r\n                                    }\r\n                                    that.$$insertFileInfo(param).then((res) => {\r\n                                        console.log(res)\r\n                                        let sucObj = {\r\n                                            name: param.fileName,\r\n                                            relatedid: param.relatedid,\r\n                                            url: param.MD5Path,\r\n                                            uuid: res.info\r\n                                        }\r\n                                        /*关联业务表成功，加入列表*/\r\n                                        that.fileList.push(sucObj);\r\n                                        //上传成功 调用onSuccess方法，否则没有完成图标,处理自己的逻辑\r\n                                        // params.onSuccess(sucObj)\r\n                                    }).catch(function (err) {\r\n                                        that.$message({\r\n                                            type: 'error',\r\n                                            message: \"上传失败\"\r\n                                        })\r\n                                    })\r\n                                } else {\r\n                                    let sucObj = {\r\n                                        name: resObj.name,\r\n                                        url: resObj.url,\r\n                                    }\r\n                                    that.fileList.push(sucObj);\r\n                                }\r\n                            }).catch(() => {\r\n                                that.$message({\r\n                                    type: 'error',\r\n                                    message: \"上传失败\"\r\n                                })\r\n                                //上传失败 调用onError方法\r\n                                //处理自己的逻辑\r\n                                params.onError(error)\r\n                            })\r\n                        } else if (checkRes && checkRes.message === \"0\") {\r\n                            /*//上传成功 调用onSuccess方法，否则没有完成图标,处理自己的逻辑\r\n                            params.onSuccess(sucObj)*/\r\n                            console.log(checkRes);\r\n                            /*已上传，加入表格*/\r\n                            if (this.relatedId !== \"\" && this.relatedId) {\r\n                                let obj = {\r\n                                    \"relatedid\": that.relatedId,\r\n                                    \"MD5Path\": checkRes.url,\r\n                                    \"fileName\": params.file.name\r\n                                }\r\n                                that.$$insertFileInfo(obj).then((res) => {\r\n                                    console.log(res)\r\n                                    let sucObj = {\r\n                                        name: obj.fileName,\r\n                                        relatedid: obj.relatedid,\r\n                                        url: obj.MD5Path,\r\n                                        uuid: res.info\r\n                                    }\r\n                                    /*关联业务表成功，加入列表*/\r\n                                    that.fileList.push(sucObj);\r\n\r\n                                }).catch(function (err) {\r\n                                    that.$message({\r\n                                        type: 'error',\r\n                                        message: \"上传失败\"\r\n                                    })\r\n                                })\r\n                                params.onSuccess(checkRes)\r\n                            } else {\r\n                                let sucObj = {\r\n                                    name: params.file.name,\r\n                                    url: checkRes.url,\r\n                                }\r\n                                that.fileList.push(sucObj);\r\n                            }\r\n                        } else {\r\n                            that.$message({\r\n                                type: 'error',\r\n                                message: \"上传失败\"\r\n                            })\r\n                        }\r\n                    })\r\n                })\r\n            },\r\n            toUploadSuccess(response, file, fileList) {\r\n            },\r\n            toUploadError(err, file, fileList) {\r\n            },\r\n            toUploadProgress(event, file, fileList) {\r\n            },\r\n            handleExceed() {\r\n                this.$message({\r\n                    type: \"warning\",\r\n                    message: \"文件个数不能超过\" + this.fileNum + \"个\"\r\n                })\r\n            },\r\n            handleChange(file, fileList) {\r\n                this.onUpChange(file, fileList)\r\n            },\r\n            beforeRemove(file, fileList) {\r\n                console.log(file);\r\n                console.log(fileList)\r\n                let that = this;\r\n                if (file.status === 'success') {\r\n                    this.$confirm(`确定移除该文件？`, '提示', {\r\n                        confirmButtonText: '确定',\r\n                        cancelButtonText: '取消',\r\n                        type: 'warning'\r\n                    }).then(() => {\r\n                        if(file.uuid){\r\n                            let param = {\r\n                                \"uuids\": file.uuid\r\n                            };\r\n                            that.$$delMultiFile(param).then((res) => {\r\n                                if (res.msg) {\r\n                                    that.handleRemove(file, fileList)\r\n                                }\r\n                                that.$message({\r\n                                    type: 'success',\r\n                                    message: '删除成功'\r\n                                });\r\n                            }).catch(function (err) {\r\n                                that.$message({\r\n                                    type: 'error',\r\n                                    message: '删除失败'\r\n                                })\r\n                            })\r\n                        }else{\r\n                            that.handleRemove(file, fileList)\r\n                        }\r\n                    }).catch(() => {\r\n                        that.$message({\r\n                            type: 'info',\r\n                            message: '取消删除'\r\n                        })\r\n                    })\r\n                } else {\r\n                    that.handleRemove(file, fileList)\r\n                }\r\n                return false\r\n            },\r\n            handleRemove(file, fileList) {\r\n                if (file.status === \"success\") {\r\n                    if(file.uuid){\r\n                        for (let i = 0; i < fileList.length; i++) {\r\n                            if (fileList[i].uuid === file.uuid) {\r\n                                fileList.splice(i, 1);\r\n                                this.fileList = fileList\r\n                                break;\r\n                            }\r\n                        }\r\n                    }else {\r\n                        for (let i = 0; i < fileList.length; i++) {\r\n                            if (fileList[i].uid === file.uid) {\r\n                                fileList.splice(i, 1);\r\n                                this.fileList = fileList\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                } else {\r\n                    for (let i = 0; i < fileList.length; i++) {\r\n                        if (fileList[i].uid === file.uid) {\r\n                            fileList.splice(i, 1);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n\r\n            handlePreview(file) {\r\n                console.log(file)\r\n                if (file.hasOwnProperty('status') && file.status === 'success') {\r\n                    this.currentFileData = file.response ? file.response : file;\r\n                    this.dialogVisible = true\r\n                } else {\r\n                    this.$message({\r\n                        type: 'warning',\r\n                        message: '请先上传，再对文件进行下载'\r\n                    })\r\n                }\r\n            },\r\n            /*单文件下载*/\r\n            downloadFile() {\r\n                let that = this;\r\n                this.$$download(this.currentFileData).then(() => {\r\n                    that.$message({\r\n                        type: 'success',\r\n                        message: '下载成功！'\r\n                    })\r\n                }).catch((err) => {\r\n                    that.$message({\r\n                        type: 'info',\r\n                        message: '下载失败！'\r\n                    })\r\n                })\r\n                this.dialogVisible = false\r\n            },\r\n            dialogClose() {\r\n                this.currentFileData = {}\r\n            },\r\n        }\r\n    }\r\n</script>\r\n\r\n<style>\r\n    .myupload .el-dialog__body {\r\n        padding: 10px 20px;\r\n        font-size: 16px;\r\n    }\r\n\r\n    .myupload .el-dialog__body-myi {\r\n        color: #EED46F;\r\n        margin-right: 20px;\r\n    }\r\n\r\n    .mytip {\r\n        font-size: 12px;\r\n        color: #909399;\r\n        margin: 3px;\r\n    }\r\n\r\n</style>\r\n"]}]}