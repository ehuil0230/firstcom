{"remainingRequest":"D:\\vueWorkspace\\cyfz\\node_modules\\babel-loader\\lib\\index.js!D:\\vueWorkspace\\cyfz\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\vueWorkspace\\cyfz\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vueWorkspace\\cyfz\\src\\components\\upAndDown\\cyUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vueWorkspace\\cyfz\\src\\components\\upAndDown\\cyUpload.vue","mtime":1570364116461},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  name: 'cyUpload',\n  props: {\n    autoUp: {\n      //自动上传\n      type: Boolean,\n      default: false\n    },\n    fileNum: {\n      type: Number,\n      default: 10000\n    },\n    relatedId: {\n      type: String,\n      default: ''\n    }\n  },\n  data: function data() {\n    return {\n      dialogVisible: false,\n      fileList: []\n    };\n  },\n  created: function created() {\n    var that = this;\n    /*请求业务接口*/\n\n    if (this.relatedId !== \"\") {\n      this.$$queryFileList({\n        \"relatedid\": this.relatedId\n      }).then(function (res) {\n        return res.info;\n      }).then(function (data) {\n        if (data.length > 0) {\n          data.forEach(function (item) {\n            var obj = {\n              relatedid: item.relatedid,\n              uuid: item.uuid,\n              name: item.fileName,\n              url: item.md5path\n            };\n            that.fileList.push(obj);\n          });\n        }\n      }).catch(function (err) {\n        that.$message({\n          type: 'error',\n          message: \"获取附件失败\"\n        });\n      });\n    }\n  },\n  methods: {\n    submitUpload: function submitUpload() {\n      this.$refs.upload.submit();\n    },\n    beforeUpload: function beforeUpload(file) {// console.log(file)\n\n      /*if (this.listType === 'picture') {\n          const isJPG = file.type === 'image/jpeg';\n          const isLt2M = file.size / 1024 / 1024 < 2;\n           if (!isJPG) {\n              this.$message.error('上传头像图片只能是 JPG 格式!');\n          }\n          if (!isLt2M) {\n              this.$message.error('上传图片大小不能超过 2MB!');\n          }\n          return isJPG && isLt2M;\n      } else {\n          return true\n      }*/\n    },\n    toUpload: function toUpload(params) {\n      var _this = this;\n\n      var that = this;\n      that.$$md5ByFile(params).then(function (res) {\n        var defaultParam = {\n          file: params.file,\n          md5: res.md5\n        };\n        that.$$md5CheckByFile(Object.assign(defaultParam, that.md5CheckParams)).then(function (checkRes) {\n          if (checkRes && checkRes.message === \"正常上传\") {\n            that.$$uploadFile(Object.assign(defaultParam, {\n              progress: params.onProgress\n            })).then(function (response) {\n              var resObj = {\n                fileExt: response.fileExt,\n                secretKey: response.secretKey,\n                fileSize: response.fileSize,\n                name: response.fileSrcName,\n                url: response.url,\n                md5: response.md5,\n                relatedid: that.relatedId\n              };\n              return resObj;\n            }).then(function (resObj) {\n              if (_this.relatedId !== \"\" && _this.relatedId) {\n                var param = {\n                  \"relatedid\": that.relatedId,\n                  \"MD5Path\": resObj.url,\n                  \"fileName\": resObj.name\n                };\n                that.$$insertFileInfo(param).then(function (res) {\n                  console.log(res);\n                  var sucObj = {\n                    name: param.fileName,\n                    relatedid: param.relatedid,\n                    url: param.MD5Path,\n                    uuid: res.info\n                    /*关联业务表成功，加入列表*/\n\n                  };\n                  that.fileList.push(sucObj); //上传成功 调用onSuccess方法，否则没有完成图标,处理自己的逻辑\n                  // params.onSuccess(sucObj)\n                }).catch(function (err) {\n                  that.$message({\n                    type: 'error',\n                    message: \"上传失败\"\n                  });\n                });\n              } else {\n                var sucObj = {\n                  name: resObj.name,\n                  url: resObj.url\n                };\n                that.fileList.push(sucObj);\n              }\n            }).catch(function () {\n              that.$message({\n                type: 'error',\n                message: \"上传失败\"\n              }); //上传失败 调用onError方法\n              //处理自己的逻辑\n\n              params.onError(error);\n            });\n          } else if (checkRes && checkRes.message === \"0\") {\n            /*//上传成功 调用onSuccess方法，否则没有完成图标,处理自己的逻辑\n            params.onSuccess(sucObj)*/\n            console.log(checkRes);\n            /*已上传，加入表格*/\n\n            if (_this.relatedId !== \"\" && _this.relatedId) {\n              var obj = {\n                \"relatedid\": that.relatedId,\n                \"MD5Path\": checkRes.url,\n                \"fileName\": params.file.name\n              };\n              that.$$insertFileInfo(obj).then(function (res) {\n                console.log(res);\n                var sucObj = {\n                  name: obj.fileName,\n                  relatedid: obj.relatedid,\n                  url: obj.MD5Path,\n                  uuid: res.info\n                  /*关联业务表成功，加入列表*/\n\n                };\n                that.fileList.push(sucObj);\n              }).catch(function (err) {\n                that.$message({\n                  type: 'error',\n                  message: \"上传失败\"\n                });\n              });\n              params.onSuccess(checkRes);\n            } else {\n              var sucObj = {\n                name: params.file.name,\n                url: checkRes.url\n              };\n              that.fileList.push(sucObj);\n            }\n          } else {\n            that.$message({\n              type: 'error',\n              message: \"上传失败\"\n            });\n          }\n        });\n      });\n    },\n    toUploadSuccess: function toUploadSuccess(response, file, fileList) {},\n    toUploadError: function toUploadError(err, file, fileList) {},\n    toUploadProgress: function toUploadProgress(event, file, fileList) {},\n    handleExceed: function handleExceed() {\n      this.$message({\n        type: \"warning\",\n        message: \"文件个数不能超过\" + this.fileNum + \"个\"\n      });\n    },\n    handleChange: function handleChange(file, fileList) {\n      this.onUpChange(file, fileList);\n    },\n    beforeRemove: function beforeRemove(file, fileList) {\n      console.log(file);\n      console.log(fileList);\n      var that = this;\n\n      if (file.status === 'success') {\n        this.$confirm(\"\\u786E\\u5B9A\\u79FB\\u9664\\u8BE5\\u6587\\u4EF6\\uFF1F\", '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          if (file.uuid) {\n            var param = {\n              \"uuids\": file.uuid\n            };\n            that.$$delMultiFile(param).then(function (res) {\n              if (res.msg) {\n                that.handleRemove(file, fileList);\n              }\n\n              that.$message({\n                type: 'success',\n                message: '删除成功'\n              });\n            }).catch(function (err) {\n              that.$message({\n                type: 'error',\n                message: '删除失败'\n              });\n            });\n          } else {\n            that.handleRemove(file, fileList);\n          }\n        }).catch(function () {\n          that.$message({\n            type: 'info',\n            message: '取消删除'\n          });\n        });\n      } else {\n        that.handleRemove(file, fileList);\n      }\n\n      return false;\n    },\n    handleRemove: function handleRemove(file, fileList) {\n      if (file.status === \"success\") {\n        if (file.uuid) {\n          for (var i = 0; i < fileList.length; i++) {\n            if (fileList[i].uuid === file.uuid) {\n              fileList.splice(i, 1);\n              this.fileList = fileList;\n              break;\n            }\n          }\n        } else {\n          for (var _i = 0; _i < fileList.length; _i++) {\n            if (fileList[_i].uid === file.uid) {\n              fileList.splice(_i, 1);\n              this.fileList = fileList;\n              break;\n            }\n          }\n        }\n      } else {\n        for (var _i2 = 0; _i2 < fileList.length; _i2++) {\n          if (fileList[_i2].uid === file.uid) {\n            fileList.splice(_i2, 1);\n            break;\n          }\n        }\n      }\n    },\n    handlePreview: function handlePreview(file) {\n      console.log(file);\n\n      if (file.hasOwnProperty('status') && file.status === 'success') {\n        this.currentFileData = file.response ? file.response : file;\n        this.dialogVisible = true;\n      } else {\n        this.$message({\n          type: 'warning',\n          message: '请先上传，再对文件进行下载'\n        });\n      }\n    },\n\n    /*单文件下载*/\n    downloadFile: function downloadFile() {\n      var that = this;\n      this.$$download(this.currentFileData).then(function () {\n        that.$message({\n          type: 'success',\n          message: '下载成功！'\n        });\n      }).catch(function (err) {\n        that.$message({\n          type: 'info',\n          message: '下载失败！'\n        });\n      });\n      this.dialogVisible = false;\n    },\n    dialogClose: function dialogClose() {\n      this.currentFileData = {};\n    }\n  }\n};",{"version":3,"sources":["cyUpload.vue"],"names":[],"mappings":"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","sourcesContent":["<!---->\r\n<template>\r\n    <div class=\"myupload\">\r\n        <el-upload\r\n                ref=\"upload\"\r\n                action=\"#\"\r\n                :http-request=\"toUpload\"\r\n                :on-progress=\"toUploadProgress\"\r\n                :on-success=\"toUploadSuccess\"\r\n                :on-error=\"toUploadError\"\r\n                :on-preview=\"handlePreview\"\r\n                :on-exceed=\"handleExceed\"\r\n                :before-remove=\"beforeRemove\"\r\n                :on-remove=\"handleRemove\"\r\n                :file-list=\"fileList\"\r\n                :auto-upload=\"autoUp\"\r\n                :limit=\"fileNum\">\r\n            <el-button slot=\"trigger\" size=\"small\" type=\"primary\" icon=\"el-icon-circle-plus\">选取文件</el-button>\r\n            <el-button v-if=\"!autoUp\" style=\"margin-left: 10px;\" size=\"small\" type=\"success\"\r\n                       @click=\"submitUpload\"\r\n                       icon=\"el-icon-upload\">\r\n                上传文件\r\n            </el-button>\r\n            <div slot=\"tip\" class=\"mytip\">\r\n                <slot name=\"mytip\"></slot>\r\n            </div>\r\n        </el-upload>\r\n        <!--不使用默认展示方式，使用表格-->\r\n        <el-dialog title=\"提示\"\r\n                   :visible.sync=\"dialogVisible\"\r\n                   width=\"30%\"\r\n                   :close=\"dialogClose\">\r\n            <span><i class=\"el-icon-warning el-dialog__body-myi\"></i>对该文件进行下载？</span>\r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button size='small' type=\"primary\" @click=\"downloadFile\">文件下载</el-button>\r\n        <el-button size='small' @click=\"dialogVisible = false\">取 消</el-button>\r\n        </span>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n<script>\r\n    export default {\r\n        name: 'cyUpload',\r\n        props: {\r\n            autoUp: {//自动上传\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            fileNum: {\r\n                type: Number,\r\n                default: 10000,\r\n            },\r\n            relatedId: {\r\n                type: String,\r\n                default: '',\r\n            }\r\n        },\r\n        data() {\r\n            return {\r\n                dialogVisible: false,\r\n                fileList: [],\r\n            }\r\n        },\r\n        created() {\r\n            let that = this;\r\n            /*请求业务接口*/\r\n            if (this.relatedId !== \"\") {\r\n                this.$$queryFileList({\r\n                    \"relatedid\": this.relatedId\r\n                }).then((res) => {\r\n                    return res.info\r\n                }).then((data) => {\r\n                    if (data.length > 0) {\r\n                        data.forEach((item) => {\r\n                            let obj = {\r\n                                relatedid: item.relatedid,\r\n                                uuid: item.uuid,\r\n                                name: item.fileName,\r\n                                url: item.md5path,\r\n                            };\r\n                            that.fileList.push(obj);\r\n                        })\r\n                    }\r\n                }).catch(function (err) {\r\n                    that.$message({\r\n                        type: 'error',\r\n                        message: \"获取附件失败\"\r\n                    })\r\n                })\r\n            }\r\n        },\r\n        methods: {\r\n            submitUpload() {\r\n                this.$refs.upload.submit()\r\n            },\r\n            beforeUpload(file) {\r\n                // console.log(file)\r\n                /*if (this.listType === 'picture') {\r\n                    const isJPG = file.type === 'image/jpeg';\r\n                    const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n                    if (!isJPG) {\r\n                        this.$message.error('上传头像图片只能是 JPG 格式!');\r\n                    }\r\n                    if (!isLt2M) {\r\n                        this.$message.error('上传图片大小不能超过 2MB!');\r\n                    }\r\n                    return isJPG && isLt2M;\r\n                } else {\r\n                    return true\r\n                }*/\r\n            },\r\n            toUpload(params) {\r\n                let that = this;\r\n                that.$$md5ByFile(params).then((res) => {\r\n                    let defaultParam = {\r\n                        file: params.file,\r\n                        md5: res.md5\r\n                    };\r\n                    that.$$md5CheckByFile(Object.assign(defaultParam, that.md5CheckParams)).then((checkRes) => {\r\n                        if (checkRes && checkRes.message === \"正常上传\") {\r\n                            that.$$uploadFile(Object.assign(defaultParam, {\r\n                                progress: params.onProgress\r\n                            })).then(function (response) {\r\n                                let resObj = {\r\n                                    fileExt: response.fileExt,\r\n                                    secretKey: response.secretKey,\r\n                                    fileSize: response.fileSize,\r\n                                    name: response.fileSrcName,\r\n                                    url: response.url,\r\n                                    md5: response.md5,\r\n                                    relatedid: that.relatedId,\r\n                                };\r\n                                return resObj;\r\n                            }).then((resObj) => {\r\n                                if (this.relatedId !== \"\" && this.relatedId) {\r\n                                    let param = {\r\n                                        \"relatedid\": that.relatedId,\r\n                                        \"MD5Path\": resObj.url,\r\n                                        \"fileName\": resObj.name\r\n                                    }\r\n                                    that.$$insertFileInfo(param).then((res) => {\r\n                                        console.log(res)\r\n                                        let sucObj = {\r\n                                            name: param.fileName,\r\n                                            relatedid: param.relatedid,\r\n                                            url: param.MD5Path,\r\n                                            uuid: res.info\r\n                                        }\r\n                                        /*关联业务表成功，加入列表*/\r\n                                        that.fileList.push(sucObj);\r\n                                        //上传成功 调用onSuccess方法，否则没有完成图标,处理自己的逻辑\r\n                                        // params.onSuccess(sucObj)\r\n                                    }).catch(function (err) {\r\n                                        that.$message({\r\n                                            type: 'error',\r\n                                            message: \"上传失败\"\r\n                                        })\r\n                                    })\r\n                                } else {\r\n                                    let sucObj = {\r\n                                        name: resObj.name,\r\n                                        url: resObj.url,\r\n                                    }\r\n                                    that.fileList.push(sucObj);\r\n                                }\r\n                            }).catch(() => {\r\n                                that.$message({\r\n                                    type: 'error',\r\n                                    message: \"上传失败\"\r\n                                })\r\n                                //上传失败 调用onError方法\r\n                                //处理自己的逻辑\r\n                                params.onError(error)\r\n                            })\r\n                        } else if (checkRes && checkRes.message === \"0\") {\r\n                            /*//上传成功 调用onSuccess方法，否则没有完成图标,处理自己的逻辑\r\n                            params.onSuccess(sucObj)*/\r\n                            console.log(checkRes);\r\n                            /*已上传，加入表格*/\r\n                            if (this.relatedId !== \"\" && this.relatedId) {\r\n                                let obj = {\r\n                                    \"relatedid\": that.relatedId,\r\n                                    \"MD5Path\": checkRes.url,\r\n                                    \"fileName\": params.file.name\r\n                                }\r\n                                that.$$insertFileInfo(obj).then((res) => {\r\n                                    console.log(res)\r\n                                    let sucObj = {\r\n                                        name: obj.fileName,\r\n                                        relatedid: obj.relatedid,\r\n                                        url: obj.MD5Path,\r\n                                        uuid: res.info\r\n                                    }\r\n                                    /*关联业务表成功，加入列表*/\r\n                                    that.fileList.push(sucObj);\r\n\r\n                                }).catch(function (err) {\r\n                                    that.$message({\r\n                                        type: 'error',\r\n                                        message: \"上传失败\"\r\n                                    })\r\n                                })\r\n                                params.onSuccess(checkRes)\r\n                            } else {\r\n                                let sucObj = {\r\n                                    name: params.file.name,\r\n                                    url: checkRes.url,\r\n                                }\r\n                                that.fileList.push(sucObj);\r\n                            }\r\n                        } else {\r\n                            that.$message({\r\n                                type: 'error',\r\n                                message: \"上传失败\"\r\n                            })\r\n                        }\r\n                    })\r\n                })\r\n            },\r\n            toUploadSuccess(response, file, fileList) {\r\n            },\r\n            toUploadError(err, file, fileList) {\r\n            },\r\n            toUploadProgress(event, file, fileList) {\r\n            },\r\n            handleExceed() {\r\n                this.$message({\r\n                    type: \"warning\",\r\n                    message: \"文件个数不能超过\" + this.fileNum + \"个\"\r\n                })\r\n            },\r\n            handleChange(file, fileList) {\r\n                this.onUpChange(file, fileList)\r\n            },\r\n            beforeRemove(file, fileList) {\r\n                console.log(file);\r\n                console.log(fileList)\r\n                let that = this;\r\n                if (file.status === 'success') {\r\n                    this.$confirm(`确定移除该文件？`, '提示', {\r\n                        confirmButtonText: '确定',\r\n                        cancelButtonText: '取消',\r\n                        type: 'warning'\r\n                    }).then(() => {\r\n                        if(file.uuid){\r\n                            let param = {\r\n                                \"uuids\": file.uuid\r\n                            };\r\n                            that.$$delMultiFile(param).then((res) => {\r\n                                if (res.msg) {\r\n                                    that.handleRemove(file, fileList)\r\n                                }\r\n                                that.$message({\r\n                                    type: 'success',\r\n                                    message: '删除成功'\r\n                                });\r\n                            }).catch(function (err) {\r\n                                that.$message({\r\n                                    type: 'error',\r\n                                    message: '删除失败'\r\n                                })\r\n                            })\r\n                        }else{\r\n                            that.handleRemove(file, fileList)\r\n                        }\r\n                    }).catch(() => {\r\n                        that.$message({\r\n                            type: 'info',\r\n                            message: '取消删除'\r\n                        })\r\n                    })\r\n                } else {\r\n                    that.handleRemove(file, fileList)\r\n                }\r\n                return false\r\n            },\r\n            handleRemove(file, fileList) {\r\n                if (file.status === \"success\") {\r\n                    if(file.uuid){\r\n                        for (let i = 0; i < fileList.length; i++) {\r\n                            if (fileList[i].uuid === file.uuid) {\r\n                                fileList.splice(i, 1);\r\n                                this.fileList = fileList\r\n                                break;\r\n                            }\r\n                        }\r\n                    }else {\r\n                        for (let i = 0; i < fileList.length; i++) {\r\n                            if (fileList[i].uid === file.uid) {\r\n                                fileList.splice(i, 1);\r\n                                this.fileList = fileList\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                } else {\r\n                    for (let i = 0; i < fileList.length; i++) {\r\n                        if (fileList[i].uid === file.uid) {\r\n                            fileList.splice(i, 1);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n\r\n            handlePreview(file) {\r\n                console.log(file)\r\n                if (file.hasOwnProperty('status') && file.status === 'success') {\r\n                    this.currentFileData = file.response ? file.response : file;\r\n                    this.dialogVisible = true\r\n                } else {\r\n                    this.$message({\r\n                        type: 'warning',\r\n                        message: '请先上传，再对文件进行下载'\r\n                    })\r\n                }\r\n            },\r\n            /*单文件下载*/\r\n            downloadFile() {\r\n                let that = this;\r\n                this.$$download(this.currentFileData).then(() => {\r\n                    that.$message({\r\n                        type: 'success',\r\n                        message: '下载成功！'\r\n                    })\r\n                }).catch((err) => {\r\n                    that.$message({\r\n                        type: 'info',\r\n                        message: '下载失败！'\r\n                    })\r\n                })\r\n                this.dialogVisible = false\r\n            },\r\n            dialogClose() {\r\n                this.currentFileData = {}\r\n            },\r\n        }\r\n    }\r\n</script>\r\n\r\n<style>\r\n    .myupload .el-dialog__body {\r\n        padding: 10px 20px;\r\n        font-size: 16px;\r\n    }\r\n\r\n    .myupload .el-dialog__body-myi {\r\n        color: #EED46F;\r\n        margin-right: 20px;\r\n    }\r\n\r\n    .mytip {\r\n        font-size: 12px;\r\n        color: #909399;\r\n        margin: 3px;\r\n    }\r\n\r\n</style>\r\n"],"sourceRoot":"src/components/upAndDown"}]}