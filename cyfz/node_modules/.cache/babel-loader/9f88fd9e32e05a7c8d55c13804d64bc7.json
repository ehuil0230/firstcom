{"remainingRequest":"D:\\vueWorkspace\\cyfz\\node_modules\\babel-loader\\lib\\index.js!D:\\vueWorkspace\\cyfz\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\vueWorkspace\\cyfz\\src\\router\\filter.js","dependencies":[{"path":"D:\\vueWorkspace\\cyfz\\src\\router\\filter.js","mtime":1572486340385},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\vueWorkspace\\cyfz\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.function.name\";\nimport store from \"../store/store\";\nimport router from \"../router/router\";\nimport axios from 'axios';\nimport Vue from 'vue';\nimport config from \"@/routerFilter/config\";\nimport homeApi from \"../api/homeApi\";\n/*互联网和政务外网区分*/\n\nvar packageStatus = config.packsgeStatus;\nVue.prototype.$packageStatus = packageStatus;\n/*\r\n*互联网过滤，进行sso拦截\r\n*\r\n* */\n\nvar internetFilter = function internetFilter(to, from, next) {\n  //cssSsoTicket\n  if (store.state.ssoStatus.isLogin === 0) {\n    axios({\n      method: 'post',\n      url: homeApi.CcheckSSO\n    }).then(function (res) {\n      window.console.log(res, '======');\n\n      if (res.info.state == '0') {\n        /*if (to.name === \"mainPage\" || to.name === \"search\" || to.name === \"detail\" || to.name === \"more\") {\r\n            next()\r\n        } else {\r\n            window.console.log(\"========互联网单点登录0000===========\")\r\n            console.log(res.info.url)\r\n            window.location.href = res.info.url\r\n        }*/\n        next(false);\n        window.console.log(\"========互联网单点登录0000===========\");\n        console.log(res.info.url);\n        window.location.href = res.info.url;\n      } else {\n        window.console.log(\"========互联网单点登录1111===========\");\n        localStorage.setItem(\"userName\", res.info.userName);\n        store.dispatch(\"ssoStatus/toggleLogin\"); // store.commit('ssoStatus/isLogin');\n\n        next();\n      }\n    }).catch(function (err) {\n      alert(\"统一用户登录失败，请联系管理员\");\n      localStorage.setItem(\"userName\", \"\");\n      next(false);\n    });\n  } else {\n    next();\n  }\n};\n/*\r\n* 政务外网，sso拦截，\r\n* 所有页面都需要登录\r\n* */\n\n\nvar outnetFilter = function outnetFilter(to, from, next) {\n  if (store.state.ssoStatus.isLogin === 0) {\n    axios({\n      method: 'post',\n      url: homeApi.GcheckSSO\n    }).then(function (res) {\n      window.console.log(res);\n\n      if (res.info.state == '0') {\n        window.console.log(\"========政务外网单点登录0000===========\");\n        next(false); // window.location.href = res.info.url\n\n        console.log(res.info.url);\n\n        if (to.name === 'approvalDetial') {\n          var uri = \"?url=\" + encodeURI(to.name + \"&\" + to.fullPath.split('?')[1]);\n          console.log(res.info.url + uri);\n          window.location.href = res.info.url + uri;\n        } else {\n          window.location.href = res.info.url;\n        }\n      } else {\n        window.console.log(\"=========政务外网单点登录1111===========\");\n        localStorage.setItem(\"userName\", res.info.userName);\n        store.dispatch(\"ssoStatus/toggleLogin\");\n        next();\n        console.log(store.state.ssoStatus.isLogin);\n      }\n    }).catch(function (err) {\n      alert(\"统一用户登录失败，请联系管理员\");\n      localStorage.setItem(\"userName\", \"\");\n      next(false);\n    });\n  } else {\n    window.console.log(\"========政务外网单点登录2222===========\");\n    next();\n  }\n  /*if (store.state.ssoStatus.isLogin === 0){\r\n      new Promise((resolve, reject) => {\r\n          axios({\r\n              method: 'post',\r\n              url: '/GLoginCtrl/checkSSO',\r\n          }).then(function (res) {\r\n              resolve(res)\r\n          }).catch(function (err) {\r\n              reject(err)\r\n          })\r\n      }).then(function (res) {\r\n          window.console.log(\"========单点登录===========\")\r\n          window.console.log(res)\r\n          if (res.info.state == '0') {\r\n              next(false);\r\n              console.log(res.info.url)\r\n              window.location.href = res.info.url\r\n          } else {\r\n              window.console.log(\"========登录成功===========\")\r\n              next();\r\n              localStorage.setItem(\"userName\", res.info.userName);\r\n              store.dispatch(\"ssoStatus/toggleLogin\");\r\n              console.log(store.state.ssoStatus.isLogin)\r\n          }\r\n      }).catch(function (err) {\r\n          next(false)\r\n          alert(\"统一用户登录失败，请联系管理员\");\r\n          localStorage.setItem(\"userName\", \"\");\r\n      })\r\n  }else {\r\n      next()\r\n  }*/\n\n};\n\nrouter.beforeEach(function (to, from, next) {\n  window.console.log(\"-------路由拦截器:from -> to--------\");\n  window.console.log(from);\n  window.console.log(to);\n  console.log(packageStatus); //hlwzwww\n  //outnetFilter(to, from, next)\n\n  /*if(packageStatus===\"hlw\"){ /!*互联网外网*!/\r\n      internetFilter(to, from, next)\r\n  }else { /!*政务外网*!/\r\n      outnetFilter(to, from, next)\r\n  }*/\n\n  /*let toUrl=window.location.port+'/front-cyfz-web/'+to.name;\r\n  console.log(toUrl);\r\n  next()*/\n\n  next();\n});",{"version":3,"sources":["D:\\vueWorkspace\\cyfz\\src\\router\\filter.js"],"names":["store","router","axios","Vue","config","homeApi","packageStatus","packsgeStatus","prototype","$packageStatus","internetFilter","to","from","next","state","ssoStatus","isLogin","method","url","CcheckSSO","then","res","window","console","log","info","location","href","localStorage","setItem","userName","dispatch","catch","err","alert","outnetFilter","GcheckSSO","name","uri","encodeURI","fullPath","split","beforeEach"],"mappings":"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","sourcesContent":["import store from \"../store/store\";\r\nimport router from \"../router/router\";\r\nimport axios from 'axios'\r\nimport Vue from 'vue'\r\nimport config from \"@/routerFilter/config\";\r\nimport homeApi from \"../api/homeApi\";\r\n\r\n/*互联网和政务外网区分*/\r\nconst packageStatus = config.packsgeStatus\r\nVue.prototype.$packageStatus = packageStatus;\r\n\r\n/*\r\n*互联网过滤，进行sso拦截\r\n*\r\n* */\r\nconst internetFilter = (to, from, next) => {\r\n    //cssSsoTicket\r\n    if (store.state.ssoStatus.isLogin === 0) {\r\n        axios({\r\n            method: 'post',\r\n            url: homeApi.CcheckSSO\r\n        }).then(function (res) {\r\n            window.console.log(res, '======')\r\n            if (res.info.state == '0') {\r\n                /*if (to.name === \"mainPage\" || to.name === \"search\" || to.name === \"detail\" || to.name === \"more\") {\r\n                    next()\r\n                } else {\r\n                    window.console.log(\"========互联网单点登录0000===========\")\r\n                    console.log(res.info.url)\r\n                    window.location.href = res.info.url\r\n                }*/\r\n                next(false)\r\n                window.console.log(\"========互联网单点登录0000===========\")\r\n                console.log(res.info.url)\r\n                window.location.href = res.info.url\r\n            } else {\r\n                window.console.log(\"========互联网单点登录1111===========\")\r\n                localStorage.setItem(\"userName\", res.info.userName);\r\n                store.dispatch(\"ssoStatus/toggleLogin\");\r\n                // store.commit('ssoStatus/isLogin');\r\n                next();\r\n            }\r\n        }).catch(function (err) {\r\n            alert(\"统一用户登录失败，请联系管理员\");\r\n            localStorage.setItem(\"userName\", \"\");\r\n            next(false)\r\n        })\r\n    } else {\r\n        next();\r\n    }\r\n}\r\n/*\r\n* 政务外网，sso拦截，\r\n* 所有页面都需要登录\r\n* */\r\nconst outnetFilter = (to, from, next) => {\r\n    if (store.state.ssoStatus.isLogin === 0) {\r\n        axios({\r\n            method: 'post',\r\n            url: homeApi.GcheckSSO,\r\n        }).then(function (res) {\r\n            window.console.log(res)\r\n            if (res.info.state == '0') {\r\n                window.console.log(\"========政务外网单点登录0000===========\")\r\n                next(false);\r\n                // window.location.href = res.info.url\r\n                console.log(res.info.url)\r\n                if(to.name==='approvalDetial'){\r\n                    let uri = \"?url=\"+encodeURI(to.name+\"&\"+to.fullPath.split('?')[1]);\r\n                    console.log(res.info.url+uri)\r\n                    window.location.href = res.info.url+uri\r\n                }else {\r\n                    window.location.href = res.info.url\r\n                }\r\n            } else {\r\n                window.console.log(\"=========政务外网单点登录1111===========\")\r\n                localStorage.setItem(\"userName\", res.info.userName);\r\n                store.dispatch(\"ssoStatus/toggleLogin\");\r\n                next();\r\n                console.log(store.state.ssoStatus.isLogin)\r\n            }\r\n        }).catch(function (err) {\r\n            alert(\"统一用户登录失败，请联系管理员\");\r\n            localStorage.setItem(\"userName\", \"\");\r\n            next(false)\r\n        })\r\n    } else {\r\n        window.console.log(\"========政务外网单点登录2222===========\")\r\n        next();\r\n    }\r\n    /*if (store.state.ssoStatus.isLogin === 0){\r\n        new Promise((resolve, reject) => {\r\n            axios({\r\n                method: 'post',\r\n                url: '/GLoginCtrl/checkSSO',\r\n            }).then(function (res) {\r\n                resolve(res)\r\n            }).catch(function (err) {\r\n                reject(err)\r\n            })\r\n        }).then(function (res) {\r\n            window.console.log(\"========单点登录===========\")\r\n            window.console.log(res)\r\n            if (res.info.state == '0') {\r\n                next(false);\r\n                console.log(res.info.url)\r\n                window.location.href = res.info.url\r\n            } else {\r\n                window.console.log(\"========登录成功===========\")\r\n                next();\r\n                localStorage.setItem(\"userName\", res.info.userName);\r\n                store.dispatch(\"ssoStatus/toggleLogin\");\r\n                console.log(store.state.ssoStatus.isLogin)\r\n            }\r\n        }).catch(function (err) {\r\n            next(false)\r\n            alert(\"统一用户登录失败，请联系管理员\");\r\n            localStorage.setItem(\"userName\", \"\");\r\n        })\r\n    }else {\r\n        next()\r\n    }*/\r\n\r\n}\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n    window.console.log(\"-------路由拦截器:from -> to--------\");\r\n    window.console.log(from);\r\n    window.console.log(to)\r\n    console.log(packageStatus)\r\n    //hlwzwww\r\n    //outnetFilter(to, from, next)\r\n    /*if(packageStatus===\"hlw\"){ /!*互联网外网*!/\r\n        internetFilter(to, from, next)\r\n    }else { /!*政务外网*!/\r\n        outnetFilter(to, from, next)\r\n    }*/\r\n    /*let toUrl=window.location.port+'/front-cyfz-web/'+to.name;\r\n    console.log(toUrl);\r\n    next()*/\r\n    next()\r\n})\r\n\r\n"]}]}